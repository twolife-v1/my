<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Asbabun Nuzul</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root[data-theme="light"] { --primary:#A67734; --primary-light:#FDF8F0; --bg:#F8F9FA; --surface:#FFFFFF; --text:#1F2937; --text-muted:#6B7280; --border:#E5E7EB; }
        :root[data-theme="dark"] { --primary:#D4AF37; --primary-light:#2A2012; --bg:#121212; --surface:#1E1E1E; --text:#F3F4F6; --text-muted:#9CA3AF; --border:#374151; }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 20px; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 80px; transition: background 0.3s; }

        /* Header & Navigation */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-top: env(safe-area-inset-top); }
        .back-btn { background: var(--surface); border: 1px solid var(--border); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--text); cursor: pointer; text-decoration: none; transition: 0.2s; }
        .back-btn:active { transform: scale(0.95); background: var(--border); }
        .icon-btn-glass { background: var(--surface); border: 1px solid var(--border); color: var(--text); width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 11px; font-weight: 800; transition: 0.2s; }

        /* Search */
        .search-wrapper { position: sticky; top: 0; z-index: 10; background: var(--bg); padding-bottom: 10px; }
        .search-box { width: 100%; padding: 14px 20px; border-radius: 16px; border: 1px solid var(--border); background: var(--surface); color: var(--text); font-family: 'Inter', sans-serif; outline: none; box-shadow: 0 4px 15px rgba(0,0,0,0.03); -webkit-appearance: none; }
        .search-box:focus { border-color: var(--primary); }

        /* List View */
        .story-list { display: flex; flex-direction: column; gap: 12px; }
        .story-card { display: flex; align-items: center; padding: 16px; background: var(--surface); border: 1px solid var(--border); border-radius: 18px; cursor: pointer; transition: 0.2s; }
        .story-card:active { transform: scale(0.98); background: var(--primary-light); }
        
        /* Surah Badge */
        .surah-badge { width: 50px; height: 50px; border-radius: 14px; background: var(--primary-light); color: var(--primary); display: flex; flex-direction: column; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0; border: 1px solid rgba(0,0,0,0.05); padding: 2px; }
        .surah-badge span { font-size: 8px; opacity: 0.8; text-transform: uppercase; margin-bottom: 2px; }
        .surah-badge strong { font-size: 10px; font-weight: 800; text-align: center; line-height: 1.1; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        .story-content { flex: 1; }
        .story-title { font-weight: 700; font-size: 14px; margin-bottom: 4px; line-height: 1.2; }
        .story-preview { font-size: 11px; color: var(--text-muted); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.4; }

        /* Reading Mode Overlay */
        #articleView { position: fixed; inset: 0; background: var(--bg); z-index: 50; padding: 20px; overflow-y: auto; display: none; animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .article-body { background: var(--surface); padding: 25px; border-radius: 24px; border: 1px solid var(--border); min-height: 60vh; padding-bottom: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .article-header-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; background: var(--primary-light); color: var(--primary); font-size: 11px; font-weight: 800; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 0.5px; }
        .article-body h1 { font-size: 22px; margin-top: 0; margin-bottom: 25px; color: var(--text); line-height: 1.3; }
        
        .verse-box { background: var(--bg); border-left: 4px solid var(--primary); padding: 15px; margin-bottom: 25px; border-radius: 12px; }
        .verse-arabic { font-family: 'Amiri', serif; font-size: 24px; text-align: right; direction: rtl; color: var(--primary); margin-bottom: 10px; line-height: 2.2; }
        .verse-trans { font-size: 13px; font-style: italic; color: var(--text-muted); line-height: 1.6; }
        .story-text { font-size: 15px; line-height: 1.8; color: var(--text); white-space: pre-wrap; }
    </style>
</head>
<body>

    <div class="header">
        <a href="index.html" onclick="if(window.history.length > 1){window.history.back(); return false;}" class="back-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
        </a>
        <div style="font-weight:800; font-size:16px;" id="pageTitle">Asbabun Nuzul</div>
        <button class="icon-btn-glass" onclick="toggleLang()" id="langBtn">EN</button>
    </div>

    <div id="listView">
        <div class="search-wrapper">
            <input type="text" class="search-box" id="searchInput" placeholder="Cari surah..." onkeyup="filterList()">
        </div>
        <div class="story-list" id="listContainer"></div>
    </div>

    <div id="articleView">
        <div class="header">
            <button class="back-btn" onclick="closeArticle()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg></button>
            <div style="font-weight:700; font-size:14px; opacity:0.8;">Reading Mode</div>
            <div style="width:40px;"></div>
        </div>
        <div class="article-body">
            <div class="article-header-badge" id="artVerse">...</div>
            <div id="verseContainer" class="verse-box">
                <div id="artArabic" class="verse-arabic"></div>
                <div id="artVerseTrans" class="verse-trans"></div>
            </div>
            <h1 id="artTitle">...</h1>
            <div id="artContent" class="story-text"></div>
        </div>
    </div>

    <script>
        // State Management
        const savedTheme = localStorage.getItem('wsl_theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        let currentLang = localStorage.getItem('wsl_lang') || 'en';
        let currentStory = null; 

        const UI_TEXT = {
            en: { title: "Asbabun Nuzul", search: "Search Surah..." },
            ms: { title: "Asbabun Nuzul", search: "Cari Surah..." }
        };

        // --- EXPANDED DATABASE ---
        const ASBAB_DB = [
            {
                surah: "Al-Fatihah", ayah: "1-7", arabic: "بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ",
                verseTrans: { ms: "Dengan nama Allah, Yang Maha Pemurah...", en: "In the name of Allah..." },
                title: { ms: "Permulaan Wahyu Yang Lengkap", en: "The First Complete Revelation" },
                story: { ms: "Malaikat Jibril mengajar Nabi SAW surah ini sebagai pembukaan Al-Quran.", en: "Angel Gabriel taught this Surah to the Prophet (SAW) as the opening of the Quran." }
            },
            {
                surah: "Ad-Duha", ayah: "1-3", arabic: "مَا وَدَّعَكَ رَبُّكَ وَمَا قَلَىٰ",
                verseTrans: { ms: "Tuhanmu tidak meninggalkanmu dan tidak benci kepadamu...", en: "Your Lord has not taken leave of you, nor has He detested [you]." },
                title: { ms: "Terhentinya Wahyu Seketika", en: "The Pause in Revelation" },
                story: { 
                    ms: "Wahyu tidak turun kepada Nabi SAW selama beberapa hari (ada riwayat kata 15 hari). Wanita musyrik (isteri Abu Lahab) mengejek: 'Syaitan (Tuhan) Muhammad telah meninggalkannya.' Nabi berasa sedih, lalu Allah menurunkan surah ini untuk memujuk baginda.",
                    en: "Revelation paused for several days. A polytheist woman (Abu Lahab's wife) mocked: 'Muhammad's devil (God) has forsaken him.' The Prophet felt sad, so Allah revealed this Surah to comfort him." 
                }
            },
            {
                surah: "Al-Ikhlas", ayah: "1-4", arabic: "قُلْ هُوَ اللَّهُ أَحَدٌ",
                verseTrans: { ms: "Katakanlah: Dia Allah, Yang Maha Esa.", en: "Say: He is Allah, [who is] One." },
                title: { ms: "Pertanyaan Tentang Nasab Tuhan", en: "Question about God's Lineage" },
                story: { 
                    ms: "Orang musyrik datang kepada Nabi SAW dan bertanya: 'Wahai Muhammad, terangkan kepada kami nasab (keturunan) Tuhanmu. Adakah Dia dari emas atau perak?' Maka turunlah surah ini menjelaskan sifat Allah.",
                    en: "Polytheists came to the Prophet (SAW) and asked: 'O Muhammad, describe to us the lineage of your Lord. Is He made of gold or silver?' So this Surah was revealed explaining Allah's attributes." 
                }
            },
            {
                surah: "Al-Falaq & An-Nas", ayah: "1-5", arabic: "قُلْ أَعُوذُ بِرَبِّ الْفَلَقِ",
                verseTrans: { ms: "Katakanlah: Aku berlindung kepada Tuhan yang menguasai subuh...", en: "Say: I seek refuge in the Lord of daybreak..." },
                title: { ms: "Sihir Terhadap Nabi SAW", en: "Magic on the Prophet" },
                story: { 
                    ms: "Seorang Yahudi bernama Labid bin Al-A'sam telah menyihir Nabi SAW menggunakan rambut baginda yang diikat pada sikat dan diletakkan di dalam perigi. Jibril memberitahu lokasi itu, dan surah Mu'awwidzatain (Falaq & Nas) turun untuk merungkaikan sihir tersebut.",
                    en: "A Jew named Labid bin Al-A'sam cast a spell on the Prophet (SAW) using his hair tied to a comb and placed it in a well. Jibril revealed the location, and the Mu'awwidzatain (Falaq & Nas) were revealed to break the spell." 
                }
            },
            {
                surah: "Yasin", ayah: "77-79", arabic: "وَضَرَبَ لَنَا مَثَلًا وَنَسِيَ خَلْقَهُ",
                verseTrans: { ms: "Dan dia membuat perumpamaan bagi Kami; dan dia lupa kepada kejadiannya sendiri...", en: "And he presents for Us an example and forgets his [own] creation..." },
                title: { ms: "Cabaran Tulang Reput", en: "The Rotten Bone Challenge" },
                story: { 
                    ms: "Ubayy bin Khalaf datang membawa tulang yang telah reput dan hancur, lalu meramasnya di hadapan Nabi SAW sambil berkata: 'Siapakah yang boleh menghidupkan tulang yang telah hancur ini?' Allah menurunkan ayat ini menjawab bahawa Tuhan yang menciptanya kali pertama mampu menghidupkannya semula.",
                    en: "Ubayy bin Khalaf brought a rotten, crumbling bone and crushed it in front of the Prophet (SAW), asking: 'Who can give life to these bones when they have rotted?' Allah revealed this verse answering that He who created it the first time can resurrect it." 
                }
            },
            {
                surah: "Al-Hujurat", ayah: "1-2", arabic: "يَا أَيُّهَا الَّذِينَ آمَنُوا لَا تَرْفَعُوا أَصْوَاتَكُمْ",
                verseTrans: { ms: "Wahai orang beriman! Janganlah kamu meninggikan suaramu...", en: "O you who have believed, do not raise your voices..." },
                title: { ms: "Pertengkaran Abu Bakr & Umar", en: "Abu Bakr & Umar Arguing" },
                story: { 
                    ms: "Abu Bakr dan Umar r.a berselisih pendapat di hadapan Nabi SAW mengenai pelantikan ketua rombongan Bani Tamim. Suara mereka menjadi tinggi sehingga turun ayat ini menegur adab bercakap di hadapan Rasulullah.",
                    en: "Abu Bakr and Umar (RA) disagreed in front of the Prophet (SAW) regarding appointing a leader for the Bani Tamim delegation. Their voices rose, so this verse was revealed teaching proper etiquette when speaking before the Messenger." 
                }
            },
            {
                surah: "At-Takathur", ayah: "1-2", arabic: "أَلْهَاكُمُ التَّكَاثُرُ",
                verseTrans: { ms: "Kamu telah dilalaikan oleh perlumbaan memperbanyakkan (harta/keturunan)...", en: "Competition in increase diverts you..." },
                title: { ms: "Bermegah-megah Antara Kabilah", en: "Boasting Between Tribes" },
                story: { 
                    ms: "Dua kabilah Ansar (Bani Harithah & Bani Harith) saling berbangga-bangga dengan jumlah ahli dan harta mereka, sehingga mereka pergi ke kubur untuk mengira ahli keluarga yang telah mati demi menunjukkan siapa lebih ramai.",
                    en: "Two Ansar tribes (Bani Harithah & Bani Harith) boasted against each other about their numbers and wealth. They even went to the graveyard to count their dead to prove who had more members." 
                }
            },
            {
                surah: "Al-Mujadilah", ayah: "1", arabic: "قَدْ سَمِعَ اللَّهُ قَوْلَ الَّتِي تُجَادِلُكَ فِي zَوْجِهَا",
                verseTrans: { ms: "Sesungguhnya Allah telah mendengar perkataan wanita yang bersoal jawab denganmu mengenai suaminya...", en: "Certainly has Allah heard the speech of the one who argues with you concerning her husband..." },
                title: { ms: "Wanita Yang Mengadu (Khaulah)", en: "The Woman Who Pleaded (Khaulah)" },
                story: { 
                    ms: "Khaulah binti Tha'labah mengadu kepada Nabi SAW bahawa suaminya telah menyamakannya dengan ibunya (Zihar - satu bentuk penceraian Arab jahiliyah). Dia merayu kepada Allah tentang nasib anak-anaknya. Allah mendengar rayuannya dari atas tujuh petala langit.",
                    en: "Khaulah bint Tha'labah complained to the Prophet (SAW) that her husband had equated her to his mother (Zihar - a form of divorce). She pleaded to Allah regarding the fate of her children. Allah heard her plea from above the seven heavens." 
                }
            },
            {
                surah: "At-Tahrim", ayah: "1", arabic: "يَا أَيُّهَا النَّبِيُّ لِمَ تُحَرِّمُ مَا أَحَلَّ اللَّهُ لَكَ",
                verseTrans: { ms: "Wahai Nabi! Mengapa engkau mengharamkan apa yang Allah halalkan bagimu...", en: "O Prophet, why do you prohibit [yourself from] what Allah has made lawful for you..." },
                title: { ms: "Peristiwa Madu", en: "The Honey Incident" },
                story: { 
                    ms: "Nabi SAW meminum madu di rumah isteri baginda Zainab binti Jahsy. Aisyah dan Hafsah r.a merancang untuk mengatakan mulut baginda berbau 'Maghafir' (sejenis getah berbau). Nabi kemudian bersumpah tidak akan minum madu lagi. Allah menegur baginda agar tidak mengharamkan yang halal.",
                    en: "The Prophet (SAW) drank honey at Zainab bint Jahsh's house. Aisha and Hafsa (RA) plotted to say his mouth smelled of 'Maghafir' (a smelly gum). The Prophet vowed never to drink honey again. Allah reprimanded him not to forbid what is lawful." 
                }
            },
            {
                surah: "Al-Baqarah", ayah: "142", arabic: "سَيَقُولُ السُّفَهَاءُ مِنَ النَّاسِ مَا وَلَّاهُمْ عَن قِبْلَتِهِمُ",
                verseTrans: { ms: "Orang-orang bodoh akan bertanya: Apakah yang memalingkan mereka dari kiblatnya...", en: "The foolish among the people will say, 'What has turned them away from their qiblah...'" },
                title: { ms: "Pertukaran Kiblat", en: "The Change of Qiblah" },
                story: { 
                    ms: "Nabi SAW dan umat Islam pada mulanya bersolat menghadap Baitul Maqdis selama 16-17 bulan. Baginda sentiasa menoleh ke langit mengharap kiblat diubah ke Kaabah. Maka Allah menurunkan ayat ini untuk menukarkan arah kiblat.",
                    en: "The Prophet (SAW) and Muslims prayed towards Jerusalem for 16-17 months. He used to look towards the sky hoping for a change. Allah then revealed this verse to change the direction to the Kaaba." 
                }
            },
            {
                surah: "Al-Kafirun", ayah: "1-6", arabic: "قُلْ يَا أَيُّهَا الْكَافِرُونَ",
                verseTrans: { ms: "Katakanlah (wahai Muhammad): Wahai orang-orang kafir!", en: "Say, 'O disbelievers!'" },
                title: { ms: "Tawaran Giliran Beribadah", en: "Proposal to Alternate Worship" },
                story: { 
                    ms: "Pihak Quraisy menawarkan satu perjanjian kepada Nabi SAW: 'Kamu sembah tuhan kami setahun, dan kami sembah Tuhanmu setahun.' Surah ini turun sebagai penolakan tegas terhadap kompromi dalam akidah.",
                    en: "The Quraysh proposed a deal: 'You worship our gods for a year, and we worship yours for a year.' This Surah was revealed as a firm rejection of compromising faith." 
                }
            },
            {
                surah: "Al-Ma'un", ayah: "1-3", arabic: "أَرَأَيْتَ الَّذِي يُكَذِّبُ بِالدِّينِ",
                verseTrans: { ms: "Tahukah engkau orang yang mendustakan agama?", en: "Have you seen the one who denies the Recompense?" },
                title: { ms: "Sifat Abu Sufyan / Abu Jahl", en: "Characteristics of Oppressors" },
                story: { 
                    ms: "Dikatakan ayat ini turun mengenai Abu Sufyan yang menyembelih unta, tetapi apabila seorang anak yatim datang meminta sedikit daging, dia menghalaunya dengan kasar menggunakan tongkat.",
                    en: "It is said this verse was revealed regarding Abu Sufyan who slaughtered a camel, but when an orphan asked for some meat, he harshly drove him away with a stick." 
                }
            },
            {
                surah: "An-Nasr", ayah: "1-3", arabic: "إِذَا جَاءَ نَصْرُ اللَّهِ وَالْفَتْحُ",
                verseTrans: { ms: "Apabila datang pertolongan Allah dan kemenangan...", en: "When the victory of Allah has come and the conquest..." },
                title: { ms: "Khabar Kewafatan Nabi SAW", en: "Tidings of the Prophet's Death" },
                story: { 
                    ms: "Surah ini turun selepas Pembukaan Kota Mekah. Para sahabat gembira, namun Ibnu Abbas dan Umar r.a menangis kerana memahami surah ini menandakan tugas Nabi SAW sudah selesai dan ajal baginda sudah dekat.",
                    en: "This Surah was revealed after the Conquest of Mecca. While most companions rejoiced, Ibn Abbas and Umar (RA) wept, realizing it signaled the completion of the Prophet's mission and his approaching end." 
                }
            },
            {
                surah: "Al-Humazah", ayah: "1", arabic: "وَيْلٌ لِّكُلِّ هُمَزَةٍ لُّمَزَةٍ",
                verseTrans: { ms: "Kecelakaanlah bagi setiap pengumpat dan pencela.", en: "Woe to every scorner and mocker." },
                title: { ms: "Ejekan Akhnas bin Syariq", en: "Mockery by Akhnas bin Shariq" },
                story: { 
                    ms: "Ayat ini turun mengenai Akhnas bin Syariq, seorang kaya yang sering mengumpat dan menghina Nabi SAW di hadapan orang ramai. Ada juga riwayat menyebut Umayyah bin Khalaf.",
                    en: "This verse was revealed regarding Akhnas bin Shariq, a wealthy man who frequently backbit and insulted the Prophet (SAW). Some narrations mention Umayyah bin Khalaf." 
                }
            },
            {
                surah: "Al-Fil", ayah: "1-5", arabic: "أَلَمْ تَرَ كَيْفَ فَعَلَ رَبُّكَ",
                verseTrans: { ms: "Tidakkah engkau mengetahui...", en: "Have you not considered..." },
                title: { ms: "Runtuhnya Tentera Abrahah", en: "Destruction of Abrahah's Army" },
                story: { ms: "Kisah tentera bergajah yang cuba meruntuhkan Kaabah.", en: "The story of the elephant army that tried to destroy the Kaaba." }
            },
            {
                surah: "Al-Kautsar", ayah: "1-3", arabic: "إِنَّا أَعْطَيْنَاكَ الْكَوْثَرَ",
                verseTrans: { ms: "Sesungguhnya Kami telah memberi mu...", en: "Indeed, We have granted you..." },
                title: { ms: "Penghibur Hati Nabi", en: "Consolation for the Prophet" },
                story: { ms: "Turun selepas kewafatan anak lelaki Nabi SAW.", en: "Revealed after the passing of the Prophet's son." }
            },
            {
                surah: "Al-Alaq", ayah: "1-5", arabic: "اقْرَأْ بِاسْمِ رَبِّكَ الَّذِي خَلَقَ",
                verseTrans: { ms: "Bacalah dengan nama Tuhanmu...", en: "Recite in the name of your Lord..." },
                title: { ms: "Wahyu Pertama di Gua Hira", en: "First Revelation in Cave Hira" },
                story: { 
                    ms: "Nabi SAW didatangi Jibril ketika sedang bersendirian (tahannuth) di Gua Hira. Jibril memeluk baginda dan berkata 'Iqra!' (Baca!) sebanyak tiga kali sehingga turunlah 5 ayat pertama ini.",
                    en: "Jibril visited the Prophet (SAW) while he was meditating in Cave Hira. Jibril embraced him and said 'Iqra!' (Read!) three times until these first 5 verses were revealed." 
                }
            },
            {
                surah: "Al-Qadr", ayah: "1-5", arabic: "إِنَّا أَنزَلْنَاهُ فِي لَيْلَةِ الْقَدْرِ",
                verseTrans: { ms: "Sesungguhnya Kami telah menurunkannya pada malam Lailatul Qadr.", en: "Indeed, We sent it down during the Night of Decree." },
                title: { ms: "Pahala Umat Terdahulu", en: "Rewards of Previous Nations" },
                story: { 
                    ms: "Nabi SAW menceritakan tentang seorang Bani Israil yang berjihad selama 1,000 bulan tanpa henti. Sahabat berasa kecil hati dengan amal mereka. Allah menurunkan surah ini untuk memberi peluang pahala yang lebih besar dalam satu malam.",
                    en: "The Prophet (SAW) mentioned a man from the Children of Israel who performed Jihad for 1,000 months. The companions felt their deeds were insignificant. Allah revealed this Surah offering a better reward in just one night." 
                }
            },
            {
                surah: "An-Nur", ayah: "11-20", arabic: "إِنَّ الَّذِينَ جَاءُوا بِالْإِفْكِ عُصْبَةٌ مِّنكُمْ",
                verseTrans: { ms: "Sesungguhnya orang-orang yang membawa berita dusta itu...", en: "Indeed, those who came with falsehood are a group among you..." },
                title: { ms: "Fitnah Terhadap Saiditina Aisyah", en: "Slander Against Aisha (RA)" },
                story: { 
                    ms: "Berlaku peristiwa Al-Ifki di mana Aisyah r.a difitnah melakukan maksiat. Wahyu terhenti seketika menyebabkan Nabi SAW sangat sedih. Akhirnya Allah menurunkan ayat ini untuk menyucikan maruah Aisyah.",
                    en: "The Event of Slander (Al-Ifki) occurred where Aisha (RA) was falsely accused. Revelation paused, leaving the Prophet (SAW) in deep sorrow. Finally, Allah revealed these verses to exonerate her." 
                }
            },
             {
                surah: "Al-Baqarah", ayah: "189", arabic: "يَسْأَلُونَكَ عَنِ الْأَهِلَّةِ ۖ قُلْ هِيَ مَوَاقِيتُ لِلنَّاسِ وَالْحَجِّ",
                verseTrans: { ms: "Mereka bertanya kepadamu tentang anak-anak bulan...", en: "They ask you, [O Muhammad], about the new moons..." },
                title: { ms: "Fungsi Fasa Bulan", en: "Purpose of Moon Phases" },
                story: { 
                    ms: "Mu'adh bin Jabal bertanya: 'Wahai Rasulullah, mengapa bulan bermula kecil seperti benang, kemudian membesar sehingga bulat, kemudian mengecil kembali?' Allah menjawab bahawa ia adalah panduan waktu bagi manusia.",
                    en: "Mu'adh bin Jabal asked: 'O Messenger of Allah, why does the moon start thin, grow full, then shrink again?' Allah replied that it serves as a measurement of time for mankind." 
                }
            },
            {
                surah: "Al-Hasyr", ayah: "9", arabic: "وَيُؤْثِرُونَ عَلَىٰ أَنفُسِهِمْ وَلَوْ كَانَ بِهِمْ خَصَاصَةٌ",
                verseTrans: { ms: "...dan mereka mengutamakan (orang-orang Muhajirin) daripada diri mereka sendiri...", en: "...and give [them] preference over themselves, even though they are in privation..." },
                title: { ms: "Keluarga Ansar Yang Pemurah", en: "The Generous Ansar Family" },
                story: { 
                    ms: "Seorang tetamu datang kepada Nabi SAW namun baginda tiada makanan. Seorang lelaki Ansar membawa tetamu itu pulang. Walaupun hanya ada makanan untuk anak-anaknya, dia dan isterinya mematikan lampu dan berpura-pura makan supaya tetamu itu kenyang.",
                    en: "A guest came to the Prophet (SAW) who had no food. An Ansari man took the guest home. Despite having only enough for his children, he and his wife turned off the light and pretended to eat so the guest could eat his fill." 
                }
            },
            {
                surah: "Al-Ahzab", ayah: "56", arabic: "إِنَّ اللَّهَ وَمَلَائِكَتَهُ يُصَلُّونَ عَلَى النَّبِيِّ",
                verseTrans: { ms: "Sesungguhnya Allah dan malaikat-malaikat-Nya berselawat untuk Nabi...", en: "Indeed, Allah and His angels confer blessing upon the Prophet..." },
                title: { ms: "Perintah Berselawat", en: "Order to Send Blessings" },
                story: { 
                    ms: "Para sahabat bertanya: 'Wahai Rasulullah, kami sudah tahu bagaimana memberi salam kepadamu, tetapi bagaimana cara kami berselawat?' Maka turunlah ayat ini dan Nabi mengajar Selawat Ibrahimiyah.",
                    en: "The companions asked: 'O Messenger of Allah, we know how to greet you, but how should we send blessings upon you?' This verse was revealed, and the Prophet taught the Ibrahimiyah Salawat." 
                }
            },
            {
                surah: "Al-Kahfi", ayah: "23-24", arabic: "وَلَا تَقُولَنَّ لِشَيْءٍ إِنِّي فَاعِلٌ ذَٰلِكَ غَدًا * إِلَّا أَن يَشَاءَ اللَّهُ",
                verseTrans: { ms: "Dan janganlah engkau berkata mengenai sesuatu: 'Aku akan melakukannya esok'. Melainkan (dengan menambah): 'Jika dikehendaki Allah'.", en: "And never say of anything, 'I will do that tomorrow,' Except [when adding], 'If Allah wills.'" },
                title: { ms: "Kepentingan Mengucap InshaAllah", en: "The Importance of InshaAllah" },
                story: { 
                    ms: "Kaum Quraisy bertanya 3 soalan kepada Nabi SAW (tentang Pemuda Gua, Zulkarnain, & Roh). Nabi menjawab: 'Datanglah esok, aku akan beritahu' tanpa menyebut InshaAllah. Wahyu terhenti selama 15 hari sebagai pengajaran.",
                    en: "Quraysh asked the Prophet (SAW) 3 questions. He replied: 'Come tomorrow, I will tell you' without saying InshaAllah. Revelation was delayed for 15 days as a lesson." 
                }
            },
            {
                surah: "At-Taubah", ayah: "113", arabic: "مَا كَانَ لِلنَّبِيِّ وَالَّذِينَ آمَنُوا أَن يَسْتَغْفِرُوا لِلْمُشْرِكِينَ",
                verseTrans: { ms: "Tidaklah dibenarkan bagi Nabi dan orang-orang yang beriman meminta ampun bagi orang-orang musyrik...", en: "It is not for the Prophet and those who have believed to ask forgiveness for the polytheists..." },
                title: { ms: "Permohonan Ampun Untuk Abu Talib", en: "Asking Forgiveness for Abu Talib" },
                story: { 
                    ms: "Apabila bapa saudara Nabi SAW, Abu Talib meninggal dalam keadaan tidak beriman, Nabi berkata: 'Aku akan meminta ampun bagimu selagi tidak dilarang.' Maka Allah menurunkan ayat ini untuk melarang perbuatan tersebut.",
                    en: "When the Prophet's uncle, Abu Talib, died as a non-believer, the Prophet said: 'I will keep asking forgiveness for you until I am forbidden.' Allah then revealed this verse to forbid it." 
                }
            },
            {
                surah: "Al-Muddathir", ayah: "1-2", arabic: "يَا أَيُّهَا الْمُدَّثِّرُ * قُمْ فَأَنذِرْ",
                verseTrans: { ms: "Wahai orang yang berselimut! Bangunlah, lalu berilah peringatan!", en: "O you who covers himself [with a garment], Arise and warn." },
                title: { ms: "Perintah Berdakwah Secara Terbuka", en: "Order for Public Preaching" },
                story: { 
                    ms: "Nabi SAW pulang ke rumah dalam keadaan gementar selepas melihat Jibril di langit. Baginda meminta diselimutkan. Lalu Allah menurunkan ayat ini memerintahkan baginda memulakan dakwah.",
                    en: "The Prophet (SAW) returned home trembling after seeing Jibril in the sky. He asked to be covered. Allah then revealed this verse, ordering him to begin his preaching." 
                }
            },
            {
                surah: "Al-Mutaffifin", ayah: "1", arabic: "وَيْلٌ لِّلْمُطَفِّفِينَ",
                verseTrans: { ms: "Kecelakaan besar bagi orang-orang yang curang (dalam timbangan).", en: "Woe to those who give less [than due]." },
                title: { ms: "Kecurangan Penduduk Madinah", en: "Dishonesty of Madinah Dwellers" },
                story: { 
                    ms: "Apabila Nabi SAW tiba di Madinah, penduduknya adalah orang yang paling teruk dalam menimbang barang. Selepas ayat ini turun, mereka menjadi orang yang paling jujur dalam berniaga.",
                    en: "When the Prophet (SAW) arrived in Madinah, the people were among the worst in weights and measures. After this verse was revealed, they became the most honest in trade." 
                }
            },
            {
                surah: "Abasa", ayah: "1", arabic: "عَبَسَ وَتَوَلَّىٰ",
                verseTrans: { ms: "Dia memasamkan muka...", en: "The Prophet frowned..." },
                title: { ms: "Teguran Abdullah Ummi Maktum", en: "Reprimand regarding Abdullah Ummi Maktum" },
                story: { ms: "Teguran Allah apabila Nabi SAW berpaling dari orang buta demi pembesar Quraisy.", en: "Allah's reprimand when the Prophet turned away from a blind man to speak to leaders." }
            },
            {
                surah: "Al-Masad", ayah: "1", arabic: "تَبَّتْ يَدَا أَبِي لَهَبٍ",
                verseTrans: { ms: "Binasalah tangan Abu Lahab...", en: "Perish the hands of Abu Lahab..." },
                title: { ms: "Penentangan Abu Lahab", en: "Resistance of Abu Lahab" },
                story: { ms: "Balasan kepada kutukan Abu Lahab di Bukit Safa.", en: "Response to Abu Lahab's curse at Mount Safa." }
            },
            {
                surah: "Al-Layl", ayah: "1-4", arabic: "وَاللَّيْلِ إِذَا يَغْشَىٰ",
                verseTrans: { ms: "Demi malam apabila menutupi (cahaya siang)...", en: "By the night when it covers..." },
                title: { ms: "Abu Bakr Memerdekakan Bilal", en: "Abu Bakr Freeing Bilal" },
                story: { 
                    ms: "Umayyah bin Khalaf menyeksa Bilal r.a yang beriman. Abu Bakr membeli dan memerdekakan Bilal. Orang musyrik berkata Abu Bakr berbuat demikian kerana terhutang budi, namun ayat ini turun menjelaskan keikhlasan Abu Bakr semata-mata kerana Allah.",
                    en: "Umayyah bin Khalaf tortured Bilal (RA) for his faith. Abu Bakr bought and freed him. Polytheists claimed Abu Bakr did it to repay a debt, but this verse was revealed clarifying his sincerity was solely for Allah." 
                }
            },
            {
                surah: "Al-Munafiqun", ayah: "8", arabic: "يَقُولُونَ لَئِن رَّجَعْنَا إِلَى الْمَدِينَةِ لَيُخْرِجَنَّ الْأَعَزُّ مِنْهَا الْأَذَلَّ",
                verseTrans: { ms: "Mereka berkata: Jika kita kembali ke Madinah, orang yang mulia pasti akan mengusir orang yang hina...", en: "They say, 'If we return to al-Madinah, the more honored [for power] will surely expel therefrom the more humble.'" },
                title: { ms: "Keangkuhan Abdullah bin Ubayy", en: "Arrogance of Abdullah bin Ubayy" },
                story: { 
                    ms: "Dalam satu ekspedisi, Abdullah bin Ubayy (Ketua Munafik) menghina kaum Muhajirin dan menggelar dirinya 'Yang Mulia' dan Nabi sebagai 'Yang Hina'. Zaid bin Arqam melaporkan hal ini. Abdullah bersumpah dia tidak berkata demikian, namun Allah menurunkan ayat ini membenarkan kata-kata Zaid.",
                    en: "During an expedition, Abdullah bin Ubayy (Leader of Hypocrites) insulted the Muhajirin, calling himself 'The Honored' and the Prophet 'The Humble'. Zaid bin Arqam reported this. Abdullah swore he didn't say it, but Allah revealed this verse confirming Zaid's report." 
                }
            }
        ];

        function init() { updateUI(); renderList(); }
        
        function toggleLang() { 
            currentLang = currentLang === 'en' ? 'ms' : 'en'; 
            localStorage.setItem('wsl_lang', currentLang); 
            updateUI(); 
            renderList();
            
            if(currentStory && document.getElementById('articleView').style.display === 'block') {
                populateArticleData(currentStory);
            }
        }

        function updateUI() { 
            document.getElementById('pageTitle').textContent = UI_TEXT[currentLang].title; 
            document.getElementById('searchInput').placeholder = UI_TEXT[currentLang].search; 
            document.getElementById('langBtn').textContent = currentLang.toUpperCase(); 
        }

        function renderList() {
            const list = document.getElementById('listContainer');
            const query = document.getElementById('searchInput').value.toLowerCase();
            list.innerHTML = '';
            
            const filtered = ASBAB_DB.filter(s => s.title[currentLang].toLowerCase().includes(query) || s.surah.toLowerCase().includes(query));
            
            if(filtered.length === 0) { 
                list.innerHTML = `<div style="text-align:center; padding:40px 20px; color:var(--text-muted); opacity:0.7;">${currentLang==='en'?'No result found':'Tiada hasil ditemui'}</div>`; 
                return; 
            }
            
            filtered.forEach(s => {
                const el = document.createElement('div');
                el.className = 'story-card';
                el.onclick = () => openStory(s);
                el.innerHTML = `
                    <div class="surah-badge">
                        <span>SURAH</span>
                        <strong>${s.surah}</strong>
                    </div>
                    <div class="story-content">
                        <div class="story-title">${s.title[currentLang]}</div>
                        <div class="story-preview">${s.story[currentLang]}</div>
                    </div>`;
                list.appendChild(el);
            });
        }

        function filterList() { renderList(); }

        function openStory(s) {
            currentStory = s;
            populateArticleData(s);
            document.getElementById('articleView').style.display = 'block';
        }

        function populateArticleData(s) {
            document.getElementById('artVerse').textContent = `${s.surah} : ${s.ayah}`;
            document.getElementById('artArabic').textContent = s.arabic;
            document.getElementById('artVerseTrans').textContent = `"${s.verseTrans[currentLang]}"`;
            document.getElementById('artTitle').textContent = s.title[currentLang];
            document.getElementById('artContent').textContent = s.story[currentLang];
        }

        function closeArticle() { 
            document.getElementById('articleView').style.display = 'none'; 
            currentStory = null;
        }

        init();
    </script>
</body>
</html>
