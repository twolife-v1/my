<!doctype html>
<html lang="en">
<head>
  <link rel="apple-touch-icon" href="/Images/icon-512.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#d2b48c">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Waktu Solat â€” Unified</title>
  <style>
    :root{
      --bg:#F6EEE0; --card:#FFF; --muted:#6f604f; --accent:#A67734; --soft:#FFF6EE;
      --glass: rgba(255,255,255,0.28); --hero-height:360px;
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Noto Sans', Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#FFFDF8);color:#2e2a24;-webkit-font-smoothing:antialiased}
    a{color:inherit;text-decoration:none}
    /* HERO */
    .hero {
      position: relative;
      min-height: var(--hero-height);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px;
      background-size: cover;
      background-position: center;
      transition: background 1s ease;
      background-repeat: no-repeat;
    }
    .hero::before{content:'';position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0.12),rgba(0,0,0,0.02));z-index:0;border-bottom-left-radius:20px;border-bottom-right-radius:20px}
    .hero-card-bg{position:relative;z-index:2;width:100%;max-width:1100px;border-radius:16px;backdrop-filter: blur(10px);background:var(--glass);padding:16px;box-shadow:0 10px 30px rgba(16,12,8,0.08)}
    .hero-top{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
    .hero-left{display:flex;flex-direction:column;gap:6px}
    #locationName{font-weight:700;font-size:16px}
    #heroDate{font-size:13px;color:var(--muted)}
    .hero-right{text-align:right;display:flex;flex-direction:column;align-items:flex-end;gap:6px}
    #heroTime{font-size:34px;font-weight:700;letter-spacing:0.6px}
    #countdown{font-size:20px;font-weight:600;color:var(--muted)}
    #heroPrayers{margin-top:12px}
    #prayerNames,#prayerTimes{display:flex;justify-content:space-between;align-items:center;width:100%;font-weight:700}
    #prayerNames div,#prayerTimes div{flex:1;text-align:center;font-size:14px;color:var(--muted)}
    #prayerTimes div{color:#2e2a24}

    /* NAV */
    .site-nav{position:sticky;top:0;background:var(--accent);z-index:120;padding:10px 0;box-shadow:0 3px 12px rgba(0,0,0,0.08)}
    .nav-list{list-style:none;margin:0;padding:0;display:flex;gap:12px;justify-content:center;align-items:center;flex-wrap:wrap}
    .nav-list a{color:#fff;font-weight:700;padding:8px 14px;border-radius:8px;transition:transform .15s,background .15s}
    .nav-list a:hover{transform:translateY(-3px);background:rgba(255,255,255,0.12)}
    .nav-list a.active{background:#fff;color:var(--accent)}

    .container{max-width:1100px;margin:14px auto;padding:0 12px}

    main{padding:18px;max-width:1100px;margin:18px auto}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:14px}
    .card{background:var(--card);border-radius:14px;padding:14px;box-shadow:0 6px 20px rgba(18,15,12,0.06)}
    .prayer-table table{width:100%;border-collapse:collapse;margin-top:8px}
    .prayer-table th,.prayer-table td{padding:10px 8px;text-align:left;border-bottom:1px solid #f3f3f3}
    .current-row{background:linear-gradient(90deg,rgba(166,119,52,0.06),rgba(255,255,255,0));}
    .btn{padding:6px 10px;border:none;border-radius:6px;cursor:pointer;background:#A67734;color:white;font-weight:600}
    .btn.ghost{background:#fff;border:1px solid #A67734;color:#A67734}
    iframe.takwim-frame{width:100%;height:420px;border-radius:12px;border:0;background:#fff}
    @media (max-width:1100px){ .grid{grid-template-columns:1fr 1fr} }
    @media (max-width:900px){ .grid{grid-template-columns:1fr} .hero{min-height:260px} #heroTime{font-size:28px} iframe.takwim-frame{height:520px} }

    iframe.qiblat-frame { width: 180px; height: 180px; border-radius:50%; border:2px solid #A67734; display:block; overflow:hidden; }
  </style>
</head>
<body>

<!-- HERO -->
<header class="hero" id="hero" role="banner" aria-label="Prayer hero">
  <div class="hero-card-bg" id="heroCard">
    <div class="hero-top">
      <div class="hero-left">
        <div id="locationName">â€”</div>
        <div id="heroDate">â€”</div>
      </div>

      <div class="hero-right">
        <div id="heroTime">--:--:--</div>
        <div id="countdown">â€”</div>
        <div id="nextPrayer">Next: â€”</div>
      </div>
    </div>

    <div style="height:1px;background:rgba(0,0,0,0.03);margin:10px 0;border-radius:2px" aria-hidden="true"></div>

    <div id="heroPrayers" aria-live="polite">
      <div id="prayerNames" aria-hidden="false"></div>
      <div id="prayerTimes" aria-hidden="false"></div>
    </div>
  </div>
</header>

<!-- NAV -->
<nav class="site-nav" aria-label="Primary">
  <div class="nav-bar container" style="background:transparent;">
    <ul class="nav-list" role="menubar" aria-label="Main navigation">
      <li role="none"><a role="menuitem" href="#prayer" class="active">Prayer</a></li>
      <li role="none"><a role="menuitem" href="quran.html">Al Quran</a></li>
      <li role="none"><a role="menuitem" href="#qiblaWrapper">Qiblat</a></li>
      <li role="none"><a role="menuitem" href="#takwimFrame">Takwim</a></li>
      <li role="none"><a role="menuitem" href="#hadith">Daily Hadith</a></li>
      <li role="none"><a role="menuitem" href="#about">About</a></li>
    </ul>
  </div>
</nav>

<main class="container">
  <div class="grid" id="mainGrid">
    <!-- LEFT BOX: Prayer Times -->
    <section>
      <div class="card prayer-table" id="prayer">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
          <div>
            <strong id="locationNameSmall">â€”</strong>
            <div style="color:var(--muted);font-size:13px">Prayer times today</div>
          </div>
          <div style="text-align:right">
            <div id="worldTime" style="font-weight:700">--:--:--</div>
            <div style="color:var(--muted);font-size:12px">Local time</div>
          </div>
        </div>

        <div id="tableWrapper" style="margin-top:10px;">
          <table aria-label="Prayer times table">
            <thead><tr><th>Prayer</th><th>Time</th></tr></thead>
            <tbody id="prayerTableBody">
              <tr id="row-fajr"><td>Fajr</td><td id="pt-fajr">--:--</td></tr>
              <tr id="row-dhuhr"><td>Dhuhr</td><td id="pt-dhuhr">--:--</td></tr>
              <tr id="row-asr"><td>Asr</td><td id="pt-asr">--:--</td></tr>
              <tr id="row-maghrib"><td>Maghrib</td><td id="pt-maghrib">--:--</td></tr>
              <tr id="row-isha"><td>Isha</td><td id="pt-isha">--:--</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      <!-- RIGHT BOX & Remaining HTML + Scripts -->
      <!-- Daily Hadith -->
      <div class="card" id="hadith" style="margin-top:14px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Daily Hadith</strong>
          <div style="color:var(--muted);font-size:13px">Quote image (offline friendly)</div>
        </div>
        <div style="display:flex;gap:10px;margin-top:10px;align-items:center">
          <canvas id="hadithCanvas" width="160" height="160" style="border-radius:8px;background:linear-gradient(180deg,#fff,#FFF6EE)"></canvas>
          <div>
            <div id="hadithText" style="font-weight:600">Loading hadithâ€¦</div>
            <div style="color:var(--muted);font-size:13px">Source: sample</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Qibla -->
<!-- Qibla Full View -->
<div class="card" style="margin-top:14px; height:400px; display:flex; flex-direction:column; gap:8px;">
  <div id="qiblaWrapper" style="flex:1; width:100%; display:flex; justify-content:center; align-items:center; overflow:hidden;">
    <iframe id="qiblatFrame" src="qiblat.html"
            style="width:100%; height:100%; border:none; border-radius:0; display:block;"></iframe>
  </div>
  <div style="text-align:center; color:var(--muted); font-size:14px;">
    <span id="qiblaDegDisplay">â€”Â°</span>
  </div>
</div>

<!-- Takwim / Hijri -->
<div class="card" id="takwimCard" style="margin-top:14px; display:flex; flex-direction:column; gap:12px;">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <strong>Takwim & Hijri</strong>
    <div style="font-size:13px;color:var(--muted)">7-day view â€¢ Full takwim below</div>
  </div>
  <iframe id="takwimFrame" class="takwim-frame" src="Takwim-hijri.html"
          style="width:100%; height:420px; max-width:100%; border-radius:12px; border:0;"></iframe>
  <div style="display:flex;gap:8px;justify-content:flex-end">
    <button class="btn" id="openTakwimFull">Open Full</button>
  </div>
      </div>
    </aside>
  </div>
</main>

<footer style="text-align:center;padding:12px;color:var(--muted)">
  Built with care â€¢ Works offline-ish â€¢ Customize translations/data
</footer>

<!-- SCRIPT: Accurate prayer times using AlAdhan API -->
<script>
const APP = { location: null, use24:false, kaaba:{lat:21.422487, lon:39.826206} };
const storage = { get(k){try{return JSON.parse(localStorage.getItem(k))}catch(e){return null}}, set(k,v){localStorage.setItem(k,JSON.stringify(v))} };

// Format time
function formatTime(t){
  if(!t) return '--:--';
  const [h,m]=t.split(':').map(n=>parseInt(n));
  const dt=new Date(); dt.setHours(h,m,0,0);
  return dt.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',hour12:!APP.use24});
}

// Update hero prayers (5 stacked)
function renderHeroPrayers(timings){
  const order=['Fajr','Dhuhr','Asr','Maghrib','Isha'];
  const namesDiv=document.getElementById('prayerNames');
  const timesDiv=document.getElementById('prayerTimes');
  namesDiv.innerHTML=''; timesDiv.innerHTML='';
  order.forEach(p=>{
    const nameEl=document.createElement('div'); nameEl.textContent=p; namesDiv.appendChild(nameEl);
    const timeEl=document.createElement('div'); timeEl.textContent=formatTime(timings[p]); timesDiv.appendChild(timeEl);
  });
}

// Next prayer
function getNextPrayer(timings){
  const now=new Date();
  for(const p of ['Fajr','Dhuhr','Asr','Maghrib','Isha']){
    const [h,m]=timings[p].split(':').map(n=>parseInt(n));
    const dt=new Date(); dt.setHours(h,m,0,0);
    if(dt>now) return p;
  }
  return 'Fajr';
}

// Hero countdown & clock
let heroInterval = null;
const prayerBackgrounds = {
  Fajr:"Images/sunset.jpg", Dhuhr:"Images/sunset.jpg", Asr:"Images/sunset.jpg",
  Maghrib:"Images/sunset.jpg", Isha:"Images/sunset.jpg"
};
function updateHero(timings){
  if(heroInterval) clearInterval(heroInterval);
  heroInterval=setInterval(()=>{
    const next=getNextPrayer(timings);
    const [h,m]=timings[next].split(':').map(n=>parseInt(n));
    let t=new Date(); t.setHours(h,m,0,0);
    if(next==='Fajr' && t<=new Date()) t.setDate(t.getDate()+1);
    const diff=t-new Date();
    const hours=Math.floor(diff/1000/3600);
    const minutes=Math.floor((diff/1000/60)%60);
    const seconds=Math.floor((diff/1000)%60);
    document.getElementById('nextPrayer').textContent='Next: '+next;
    document.getElementById('countdown').textContent=`${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
    document.getElementById('heroTime').textContent=new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:!APP.use24});
  },1000);
}

// Fetch accurate prayer times
async function getPrayerTimes(lat, lon){
  try{
    const ts=Math.floor(new Date().getTime()/1000);
    const res=await fetch(`https://api.aladhan.com/v1/timings/${ts}?latitude=${lat}&longitude=${lon}&method=4`);
    const data=await res.json();
    if(data?.data?.timings){
      const t=data.data.timings;
      return {Fajr:t.Fajr,Dhuhr:t.Dhuhr,Asr:t.Asr,Maghrib:t.Maghrib,Isha:t.Isha};
    }
  }catch(e){ console.warn(e); }
  return {Fajr:'05:45',Dhuhr:'13:00',Asr:'16:30',Maghrib:'19:00',Isha:'20:15'};
}

// Get user location
async function getLocation(){
  let loc=storage.get('loc') || APP.location;
  if(loc?.lat && loc?.lon) { APP.location=loc; return loc; }
  if(navigator.geolocation){
    try{
      const pos=await new Promise((res,rej)=>navigator.geolocation.getCurrentPosition(res,rej,{timeout:12000,enableHighAccuracy:true}));
      loc={lat:pos.coords.latitude,lon:pos.coords.longitude,name:'My Location'};
      APP.location=loc; storage.set('loc',loc);
      return loc;
    }catch(e){console.warn(e);}
  }
  loc={lat:3.1390,lon:101.6869,name:'Kuala Lumpur'};
  APP.location=loc; storage.set('loc',loc);
  return loc;
}

// Main runner
async function runAll(){
  const loc=await getLocation();
  document.getElementById('locationName').textContent=loc.name;
  document.getElementById('locationNameSmall').textContent=loc.name;
  document.getElementById('heroDate').textContent=new Date().toDateString();
  document.getElementById('worldTime').textContent=new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:!APP.use24});
  
  const timings=await getPrayerTimes(loc.lat,loc.lon);
  renderHeroPrayers(timings);
  updateHero(timings);

  // Update table
  for(const [key,id] of [['Fajr','fajr'],['Dhuhr','dhuhr'],['Asr','asr'],['Maghrib','maghrib'],['Isha','isha']]){
    document.getElementById('pt-'+id).textContent=formatTime(timings[key]);
  }

  // Qibla
  const deg=Math.atan2(Math.sin(APP.kaaba.lon*Math.PI/180-loc.lon*Math.PI/180)*Math.cos(APP.kaaba.lat*Math.PI/180),
    Math.cos(loc.lat*Math.PI/180)*Math.sin(APP.kaaba.lat*Math.PI/180)-Math.sin(loc.lat*Math.PI/180)*Math.cos(APP.kaaba.lat*Math.PI/180)*Math.cos(APP.kaaba.lon*Math.PI/180-loc.lon*Math.PI/180)
  )*180/Math.PI;
  document.getElementById('qiblaDegDisplay').textContent=Math.round((deg+360)%360)+'Â°';
}

// Event handlers
document.getElementById('toggle24')?.addEventListener('click',()=>{
  APP.use24=!APP.use24;
  document.getElementById('toggle24').textContent='24h: '+(APP.use24?'On':'Off');
  runAll();
});
document.getElementById('setLocationBtn')?.addEventListener('click',async ()=>{
  const lat=prompt('Enter latitude:',APP.location?.lat||3.1390);
  const lon=prompt('Enter longitude:',APP.location?.lon||101.6869);
  const name=prompt('Enter location name:','My Location');
  if(lat && lon){APP.location={lat:parseFloat(lat),lon:parseFloat(lon),name:name||'My Location'};storage.set('loc',APP.location);await runAll();}
});
document.getElementById('openTakwimFull')?.addEventListener('click',()=>window.open('Takwim-hijri.html','_blank'));

// Run on load
window.addEventListener('DOMContentLoaded',runAll);

  
<!-- ðŸŒŸ Waktu Solat Lite Install Suggestion Popup -->
<style>
#solatInstallPopup {
  position: fixed;
  bottom: -70px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255,248,242,0.92);
  border: 1.5px solid var(--primary,#A67734);
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  padding: 8px 18px;
  font-family: "Poppins",sans-serif;
  text-align: center;
  z-index: 9999;
  display: none;
  transition: bottom .4s ease, opacity .4s ease;
  opacity: 0;
}

#solatInstallPopup.show {
  display: block;
  bottom: 20px;
  opacity: 1;
}

#solatInstallPopup p {
  color: var(--primary,#A67734);
  font-weight: 600;
  margin: 0;
  cursor: pointer;
}

#solatInstallPopup .closeBtn {
  position: absolute;
  top: 2px;
  right: 8px;
  font-size: 16px;
  color: #666;
  cursor: pointer;
}
</style>

<div id="solatInstallPopup">
  <span class="closeBtn" onclick="closeSolatPopup()">Ã—</span>
  <p id="solatInstallText"></p>
</div>
<script>
  window.addEventListener("beforeinstallprompt", (e) => {
  console.log("âœ… beforeinstallprompt fired");
});
// ------------------- Install Popup -------------------
let deferredPrompt = null;
let installReady = false;
let isInstalled = false;

// Detect if already installed
window.addEventListener("appinstalled", () => {
  isInstalled = true;
  localStorage.setItem("solatInstalled", "true");
  closeSolatPopup();
});

if (window.matchMedia('(display-mode: standalone)').matches || localStorage.getItem("solatInstalled") === "true") {
  isInstalled = true;
}

// Catch install prompt event
window.addEventListener("beforeinstallprompt", (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installReady = true;
  updateInstallText();
});

// Update popup text & click behavior
function updateInstallText() {
  const text = document.getElementById("solatInstallText");
  const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);

  if (isIOS) {
    text.textContent = "Add to Homescreen â¬‡ï¸";
    text.onclick = () => alert("On iOS, open Safari menu and tap 'Add to Homescreen'.");
  } else if (installReady && deferredPrompt) {
    text.textContent = "Install Waktu Solat Lite now";
    text.onclick = async () => {
      deferredPrompt.prompt();  // Show the prompt
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === "accepted") {
        console.log("PWA Installed!");
        localStorage.setItem("solatInstalled", "true");
      }
      deferredPrompt = null;
      closeSolatPopup();
    };
  } else {
    text.textContent = "Install Waktu Solat Lite now";
    text.onclick = () => alert("Use Chrome, Edge, or Brave to install Waktu Solat Lite.");
  }
}

// Show popup after 5s if not installed
window.addEventListener("load", () => {
  if (!isInstalled) {
    setTimeout(() => {
      const popup = document.getElementById("solatInstallPopup");
      updateInstallText();
      popup.style.display = "block";
      setTimeout(() => popup.classList.add("show"), 50);
    }, 5000);
  }
});

// Close popup
function closeSolatPopup() {
  const popup = document.getElementById("solatInstallPopup");
  popup.classList.remove("show");
  setTimeout(() => popup.style.display = "none", 400);
  }
  // ------------------- Service Worker Registration -------------------
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/my/service-worker.js')
      .then(reg => console.log('Service Worker registered:', reg.scope))
      .catch(err => console.error('Service Worker registration failed:', err));
  });
}
</script>
</script>
</body>
  </html>
