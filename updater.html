<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WSL Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #A67734; --bg: #F8F9FA; }
        body { background: var(--bg); font-family: 'Segoe UI', sans-serif; }
        .sidebar { background: white; min-height: 100vh; border-right: 1px solid #dee2e6; }
        .nav-link { color: #666; font-weight: 600; padding: 15px 20px; }
        .nav-link.active { background: #fff8ee; color: var(--primary); border-right: 3px solid var(--primary); }
        .card { border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-radius: 12px; margin-bottom: 20px; }
        .btn-primary { background: var(--primary); border: none; }
        .btn-primary:hover { background: #8e652b; }
        .item-row { background: #fff; border: 1px solid #eee; padding: 10px; border-radius: 8px; margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between; }
        
        /* LOCK SCREEN */
        #authOverlay { position: fixed; inset: 0; background: #212529; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        #authOverlay.unlocked { transform: translateY(-100%); pointer-events: none; }
        .pin-display { font-size: 32px; letter-spacing: 15px; margin-bottom: 30px; min-height: 40px; font-weight: bold; color: var(--primary); }
        .numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; max-width: 320px; }
        .num-btn { width: 70px; height: 70px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: white; font-size: 24px; cursor: pointer; transition: all 0.2s; display:flex; align-items:center; justify-content:center; }
        .num-btn:active { background: rgba(255,255,255,0.2); transform: scale(0.9); }
        .num-btn.submit { background: var(--primary); border-color: var(--primary); }
    </style>
</head>
<body>

    <!-- LOCK SCREEN -->
    <div id="authOverlay">
        <div class="mb-3"><i class="fas fa-user-shield fa-4x text-muted"></i></div>
        <h3 class="mb-1">Admin Access</h3>
        <p class="text-white-50 mb-4">Enter PIN</p>
        <div class="pin-display" id="pinDisplay"></div>
        <div class="numpad">
            <button class="num-btn" onclick="pressPin('1')">1</button>
            <button class="num-btn" onclick="pressPin('2')">2</button>
            <button class="num-btn" onclick="pressPin('3')">3</button>
            <button class="num-btn" onclick="pressPin('4')">4</button>
            <button class="num-btn" onclick="pressPin('5')">5</button>
            <button class="num-btn" onclick="pressPin('6')">6</button>
            <button class="num-btn" onclick="pressPin('7')">7</button>
            <button class="num-btn" onclick="pressPin('8')">8</button>
            <button class="num-btn" onclick="pressPin('9')">9</button>
            <button class="num-btn" onclick="clearPin()" style="font-size:16px; color:#ff6b6b">CLR</button>
            <button class="num-btn" onclick="pressPin('0')">0</button>
            <button class="num-btn submit" onclick="submitPin()"><i class="fas fa-arrow-right"></i></button>
        </div>
        <div class="mt-4 text-white-50 small">Default PIN: 1234</div>
    </div>

    <div class="d-flex">
        <!-- Sidebar -->
        <div class="sidebar d-flex flex-column flex-shrink-0 p-3" style="width: 260px;">
            <a href="#" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-decoration-none">
                <span class="fs-4 fw-bold ps-2" style="color:var(--primary)">WSL Admin</span>
            </a>
            <hr>
            <ul class="nav nav-pills flex-column mb-auto" id="pills-tab" role="tablist">
                <li class="nav-item"><button class="nav-link active w-100 text-start" data-bs-toggle="pill" data-bs-target="#tab-menu"><i class="fas fa-bars me-3"></i>Menu Layout</button></li>
                <li class="nav-item"><button class="nav-link w-100 text-start" data-bs-toggle="pill" data-bs-target="#tab-guides"><i class="fas fa-book-open me-3"></i>Panduan Content</button></li>
                <li class="nav-item"><button class="nav-link w-100 text-start" data-bs-toggle="pill" data-bs-target="#tab-duas"><i class="fas fa-hands-praying me-3"></i>Doa Content</button></li>
                <li class="nav-item"><button class="nav-link w-100 text-start" data-bs-toggle="pill" data-bs-target="#tab-hadith"><i class="fas fa-quote-right me-3"></i>Hadith Pool</button></li>
                <li class="nav-item"><button class="nav-link w-100 text-start" data-bs-toggle="pill" data-bs-target="#tab-announce"><i class="fas fa-bullhorn me-3"></i>Announcement</button></li>
            </ul>
        </div>

        <!-- Content -->
        <div class="flex-grow-1 p-4">
            <div class="tab-content">
                
                <!-- MENU TAB -->
                <div class="tab-pane fade show active" id="tab-menu">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Side Panel Menu</h3>
                        <div>
                            <button class="btn btn-warning text-white me-2" onclick="restoreDefaults()"><i class="fas fa-sync-alt me-1"></i> Restore Default Data</button>
                            <button class="btn btn-primary" onclick="addSection()"><i class="fas fa-plus me-1"></i> New Section</button>
                        </div>
                    </div>
                    <div class="alert alert-light border shadow-sm mb-4">
                        <i class="fas fa-info-circle text-primary me-2"></i> This manages buttons in the side panel. "Pustaka Panduan" and "Himpunan Doa" will open their respective HTML files.
                    </div>
                    <div id="menuContainer">Loading...</div>
                </div>

                <!-- GUIDES TAB -->
                <div class="tab-pane fade" id="tab-guides">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Pustaka Panduan Manager</h3>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#guideModal" onclick="resetGuideModal()"><i class="fas fa-plus me-1"></i> Add Guide</button>
                    </div>
                    <div id="guideList" class="row g-3">Loading...</div>
                </div>

                <!-- DUA TAB -->
                <div class="tab-pane fade" id="tab-duas">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Himpunan Doa Manager</h3>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#duaModal" onclick="resetDuaModal()"><i class="fas fa-plus me-1"></i> Add Dua</button>
                    </div>
                    <div id="duaList" class="row g-3">Loading...</div>
                </div>

                <!-- HADITH TAB -->
                <div class="tab-pane fade" id="tab-hadith">
                    <h3>Daily Hadith Pool</h3>
                    <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#hadithModal"><i class="fas fa-plus"></i> Add Hadith</button>
                    <div id="hadithList"></div>
                </div>

                <!-- ANNOUNCEMENT TAB -->
                <div class="tab-pane fade" id="tab-announce">
                    <h3>Home Screen Banner</h3>
                    <div class="card p-4 shadow-sm">
                        <textarea class="form-control mb-3" id="announceText" rows="3" placeholder="Contoh: Selamat Hari Raya Aidilfitri..."></textarea>
                        <div class="form-check form-switch mb-4">
                            <input class="form-check-input" type="checkbox" id="announceActive">
                            <label class="form-check-label" for="announceActive">Show Banner</label>
                        </div>
                        <button class="btn btn-primary" onclick="saveAnnouncement()">Save Changes</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- MODALS -->
    
    <!-- Edit Menu Item Modal -->
    <div class="modal fade" id="itemModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Edit Button</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <input type="hidden" id="editSectionIndex"><input type="hidden" id="editItemIndex">
                    <div class="mb-2"><label>Label</label><input type="text" class="form-control" id="itemLabel"></div>
                    <div class="mb-2"><label>Icon (FontAwesome)</label><input type="text" class="form-control" id="itemIcon" placeholder="fas fa-book"></div>
                    <div class="mb-2"><label>Type</label><select class="form-select" id="itemType" onchange="toggleAction()"><option value="function">Internal Function</option><option value="link">External Link (URL)</option></select></div>
                    <div class="mb-2" id="fieldFunc"><label>Function Name</label><input type="text" class="form-control" id="itemFunction" placeholder="openExternalPanduan()"></div>
                    <div class="mb-2 d-none" id="fieldLink"><label>URL</label><input type="text" class="form-control" id="itemUrl" placeholder="https://..."></div>
                </div>
                <div class="modal-footer"><button class="btn btn-primary" onclick="saveItemChange()">Save Changes</button></div>
            </div>
        </div>
    </div>

    <!-- Guide Modal -->
    <div class="modal fade" id="guideModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Guide Editor</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <input type="hidden" id="guideId">
                    <div class="mb-3"><label class="fw-bold">Title</label><input id="guideTitle" class="form-control" placeholder="e.g. Panduan Solat Jenazah"></div>
                    <div class="mb-3"><label class="fw-bold">Icon (Emoji)</label><input id="guideIcon" class="form-control" placeholder="e.g. âš°ï¸"></div>
                    <div class="mb-3">
                        <label class="fw-bold">Content (HTML Supported)</label>
                        <textarea id="guideContent" class="form-control" rows="10" placeholder="Type here... Use <b>bold</b> or <br> for new lines."></textarea>
                    </div>
                </div>
                <div class="modal-footer"><button class="btn btn-primary" onclick="saveGuide()">Save Guide</button></div>
            </div>
        </div>
    </div>

    <!-- Dua Modal -->
    <div class="modal fade" id="duaModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Dua Editor</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <input type="hidden" id="duaId">
                    <div class="mb-3"><label class="fw-bold">Title</label><input id="duaTitle" class="form-control" placeholder="e.g. Doa Masuk Masjid"></div>
                    <div class="mb-3"><label class="fw-bold">Icon (Emoji)</label><input id="duaIcon" class="form-control" placeholder="e.g. ðŸ•Œ"></div>
                    <div class="mb-3">
                        <label class="fw-bold">Content (HTML Supported)</label>
                        <textarea id="duaContent" class="form-control" rows="10" placeholder="Use <div class='content-guide-item'>...</div> structure for consistency."></textarea>
                        <small class="text-muted">Tip: Use Arabic text inside HTML for better formatting.</small>
                    </div>
                </div>
                <div class="modal-footer"><button class="btn btn-primary" onclick="saveDua()">Save Dua</button></div>
            </div>
        </div>
    </div>
    
    <!-- Hadith Modal -->
    <div class="modal fade" id="hadithModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"><textarea id="newHText" class="form-control mb-2" placeholder="Hadith Text"></textarea><input id="newHSource" class="form-control" placeholder="Source (e.g. Bukhari)"></div><div class="modal-footer"><button class="btn btn-primary" onclick="saveNewHadith()">Add</button></div></div></div></div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // PIN LOCK
        let currentPin = ""; const CORRECT_PIN = "1234";
        function pressPin(n){ if(currentPin.length<4){ currentPin+=n; document.getElementById('pinDisplay').innerHTML='*'.repeat(currentPin.length); } }
        function clearPin(){ currentPin=""; document.getElementById('pinDisplay').innerHTML=""; }
        function submitPin(){ if(currentPin===CORRECT_PIN){ document.getElementById('authOverlay').classList.add('unlocked'); }else{ alert("Incorrect PIN!"); clearPin(); } }

        // FIREBASE
        const firebaseConfig = { apiKey: "AIzaSyBQMVNRDYsKHRj_-bwKbFICyN6XseL3CDI", authDomain: "waktusolatlite.firebaseapp.com", databaseURL: "https://waktusolatlite-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "waktusolatlite", storageBucket: "waktusolatlite.firebasestorage.app", messagingSenderId: "86910439082", appId: "1:86910439082:web:e482d01e1451e58179cad3" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // DEFAULT DATA 
        const defaultGuides = {
            "g1": { title: "Solat Jenazah", icon: "âš°ï¸", content: "<p>Panduan lengkap solat jenazah...</p>" },
            "g2": { title: "Panduan Wudhu", icon: "ðŸ’§", content: "<p>Cara mengambil wudhu...</p>" }
        };
        const defaultDuas = {
            "d1": { title: "Doa Qunut", icon: "ðŸ¤²", content: "<p>Bacaan doa qunut...</p>" },
            "d2": { title: "Doa Selepas Solat", icon: "ðŸ“¿", content: "<p>Wirid dan doa ringkas...</p>" }
        };
        const defaultMenu = [
            { title: "Hadith Collections", items: [ { label: "Sahih Bukhari", type: "function", action: "openHadithCollection('bukhari')", icon: "fas fa-book" }, { label: "Sahih Muslim", type: "function", action: "openHadithCollection('muslim')", icon: "fas fa-book-open" }, { label: "40 Hadith", type: "function", action: "openHadithCollection('nawawi')", icon: "fas fa-scroll" }, { label: "Asbabun Nuzul", type: "function", action: "openHadithCollection('asbabun')", icon: "fas fa-lightbulb" } ] },
            { title: "Panduan & Rujukan", items: [ { label: "Pustaka Panduan", type: "function", action: "openExternalPanduan()", icon: "fas fa-mosque" } ] },
            { title: "Amalan Harian", items: [ { label: "Himpunan Doa", type: "function", action: "openExternalDoa()", icon: "fas fa-hands-praying" } ] }
        ];

        let menuData = [];
        window.onload = function() { loadMenu(); loadGuides(); loadDuas(); loadHadiths(); loadAnnouncement(); }

        function restoreDefaults() {
            if(confirm("Reset menu and inject default data for Guides and Duas?")) {
                Promise.all([
                    db.ref('dynamicMenu').set(defaultMenu),
                    // db.ref('guides').set(defaultGuides), // Optional: Uncomment to reset guides content
                    // db.ref('duas_content').set(defaultDuas) // Optional: Uncomment to reset duas content
                ]).then(() => alert("Restored!")).catch(e => alert(e.message));
            }
        }

        // MENU
        function loadMenu() { db.ref('dynamicMenu').on('value', snap => { menuData = snap.val() || []; renderMenu(); }); }
        function renderMenu() {
            const c = document.getElementById('menuContainer'); c.innerHTML = '';
            menuData.forEach((sec, sIdx) => {
                let items = ''; (sec.items||[]).forEach((it, iIdx) => { items += `<div class="item-row"><div><i class="${it.icon} text-primary me-2"></i>${it.label}</div><div><button class="btn btn-sm btn-light border" onclick="editItem(${sIdx},${iIdx})">Edit</button></div></div>`; });
                c.innerHTML += `<div class="card p-3"><h5>${sec.title}</h5>${items}</div>`;
            });
        }
        // ... (Keep existing menu add/edit functions) ... 
        window.addSection=()=>db.ref('dynamicMenu').set([...menuData, {title:"New Section", items:[]}]);
        window.delSec=(i)=>{if(confirm("Del?")){menuData.splice(i,1);db.ref('dynamicMenu').set(menuData)}};
        window.updTitle=(i,v)=>{menuData[i].title=v;db.ref('dynamicMenu').set(menuData)};
        window.delItem=(s,i)=>{if(confirm("Del?")){menuData[s].items.splice(i,1);db.ref('dynamicMenu').set(menuData)}};
        window.addItem=(s)=>setupModal(s,'new'); window.editItem=(s,i)=>setupModal(s,i);
        function setupModal(s,i){
            document.getElementById('editSectionIndex').value=s; document.getElementById('editItemIndex').value=i;
            const item=(i==='new')?{label:'',icon:'',type:'function',action:''}:menuData[s].items[i];
            document.getElementById('itemLabel').value=item.label; document.getElementById('itemIcon').value=item.icon; document.getElementById('itemType').value=item.type;
            toggleAction();
            if(item.type==='link') document.getElementById('itemUrl').value=item.action; else document.getElementById('itemFunction').value=item.action;
            new bootstrap.Modal(document.getElementById('itemModal')).show();
        }
        window.toggleAction=()=>{const t=document.getElementById('itemType').value;document.getElementById('fieldLink').classList.toggle('d-none',t!=='link');document.getElementById('fieldFunc').classList.toggle('d-none',t!=='function')};
        window.saveItemChange=()=>{
            const s=document.getElementById('editSectionIndex').value, i=document.getElementById('editItemIndex').value, t=document.getElementById('itemType').value;
            const act=t==='link'?document.getElementById('itemUrl').value:document.getElementById('itemFunction').value;
            const obj={label:document.getElementById('itemLabel').value,icon:document.getElementById('itemIcon').value,type:t,action:act};
            if(!menuData[s].items)menuData[s].items=[]; if(i==='new')menuData[s].items.push(obj); else menuData[s].items[i]=obj;
            db.ref('dynamicMenu').set(menuData); bootstrap.Modal.getInstance(document.getElementById('itemModal')).hide();
        }

        // GUIDES MANAGER (PANDUAN)
        function loadGuides() {
            db.ref('guides').on('value', snap => {
                const list = document.getElementById('guideList'); list.innerHTML = '';
                if(!snap.exists()) return;
                snap.forEach(c => { const g=c.val(); list.innerHTML += `<div class="col-md-6"><div class="card p-3"><h5>${g.icon} ${g.title}</h5><button class="btn btn-sm btn-outline-secondary mt-2" onclick="editGuide('${c.key}')">Edit Content</button></div></div>`; });
            });
        }
        window.resetGuideModal=()=>{document.getElementById('guideId').value='';document.getElementById('guideTitle').value='';document.getElementById('guideIcon').value='';document.getElementById('guideContent').value='';}
        window.editGuide=(k)=>{db.ref('guides/'+k).once('value').then(s=>{const v=s.val();document.getElementById('guideId').value=k;document.getElementById('guideTitle').value=v.title;document.getElementById('guideIcon').value=v.icon;document.getElementById('guideContent').value=v.content;new bootstrap.Modal(document.getElementById('guideModal')).show()})};
        window.saveGuide=()=>{const k=document.getElementById('guideId').value;const d={title:document.getElementById('guideTitle').value,icon:document.getElementById('guideIcon').value,content:document.getElementById('guideContent').value};if(k)db.ref('guides/'+k).update(d);else db.ref('guides').push(d);bootstrap.Modal.getInstance(document.getElementById('guideModal')).hide()};

        // DUAS MANAGER (DOA) - Uses 'duas_content' node to distinguish from simple notifications
        function loadDuas() {
            db.ref('duas_content').on('value', snap => {
                const list = document.getElementById('duaList'); list.innerHTML = '';
                if(!snap.exists()) return;
                snap.forEach(c => { const g=c.val(); list.innerHTML += `<div class="col-md-6"><div class="card p-3"><h5>${g.icon} ${g.title}</h5><button class="btn btn-sm btn-outline-secondary mt-2" onclick="editDua('${c.key}')">Edit Content</button></div></div>`; });
            });
        }
        window.resetDuaModal=()=>{document.getElementById('duaId').value='';document.getElementById('duaTitle').value='';document.getElementById('duaIcon').value='';document.getElementById('duaContent').value='';}
        window.editDua=(k)=>{db.ref('duas_content/'+k).once('value').then(s=>{const v=s.val();document.getElementById('duaId').value=k;document.getElementById('duaTitle').value=v.title;document.getElementById('duaIcon').value=v.icon;document.getElementById('duaContent').value=v.content;new bootstrap.Modal(document.getElementById('duaModal')).show()})};
        window.saveDua=()=>{const k=document.getElementById('duaId').value;const d={title:document.getElementById('duaTitle').value,icon:document.getElementById('duaIcon').value,content:document.getElementById('duaContent').value};if(k)db.ref('duas_content/'+k).update(d);else db.ref('duas_content').push(d);bootstrap.Modal.getInstance(document.getElementById('duaModal')).hide()};

        // ... (Keep Hadith/Announcement logic same as before) ...
        function loadHadiths(){db.ref('hadiths').on('value',s=>{const d=document.getElementById('hadithList');d.innerHTML='';s.forEach(x=>{d.innerHTML+=`<div class="item-row"><span>${x.val().text.substr(0,30)}...</span><button class="btn btn-sm btn-danger" onclick="db.ref('hadiths/${x.key}').remove()">X</button></div>`})})}
        window.saveNewHadith=()=>{db.ref('hadiths').push({text:document.getElementById('newHText').value,source:document.getElementById('newHSource').value});bootstrap.Modal.getInstance(document.getElementById('hadithModal')).hide()}
        function loadAnnouncement(){db.ref('announcement').on('value',s=>{const v=s.val()||{};document.getElementById('announceText').value=v.text||'';document.getElementById('announceActive').checked=v.show})}
        window.saveAnnouncement=()=>{db.ref('announcement').set({text:document.getElementById('announceText').value,show:document.getElementById('announceActive').checked})}
    </script>
</body>
</html>

