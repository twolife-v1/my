<!DOCTYPE html>
<html lang="ms" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kutub Tis'ah</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        /* Shared Variables & Theme */
        :root[data-theme="light"] { --primary:#A67734; --bg:#F8F9FA; --surface:#FFFFFF; --text:#1F2937; --text-muted:#6B7280; --border:#E5E7EB; --input-bg:#F3F4F6; }
        :root[data-theme="dark"] { --primary:#D4AF37; --bg:#121212; --surface:#1E1E1E; --text:#F3F4F6; --text-muted:#9CA3AF; --border:#374151; --input-bg:#2A2A2A; }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 20px; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding-bottom: 90px; }

        /* Header */
        .header { text-align: center; margin-bottom: 20px; }
        h1 { font-size: 22px; font-weight: 800; margin: 0; color: var(--primary); }
        .subtitle { font-size: 12px; color: var(--text-muted); margin-top: 5px; }

        /* Book Selector (Dropdown) */
        .selector-wrapper { margin-bottom: 15px; }
        .book-select { width: 100%; padding: 14px; border-radius: 12px; background: var(--surface); color: var(--primary); border: 1px solid var(--border); font-size: 15px; font-weight: 700; outline: none; appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 15px center; background-size: 16px; }

        /* Controls */
        .controls { display: flex; gap: 10px; margin-bottom: 20px; align-items: center; }
        .search-input { flex: 1; padding: 12px; border-radius: 12px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text); font-family: inherit; font-weight: 600; font-size: 14px; outline: none; }
        .action-btn { background: var(--primary); color: white; border: none; border-radius: 12px; padding: 0 20px; height: 44px; font-weight: 700; cursor: pointer; font-size: 13px; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .action-btn:active { transform: scale(0.96); }
        .action-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Hadith Cards */
        .hadith-card { background: var(--surface); border-radius: 16px; padding: 20px; margin-bottom: 15px; border: 1px solid var(--border); box-shadow: 0 2px 5px rgba(0,0,0,0.02); animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .card-header { display: flex; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px dashed var(--border); padding-bottom: 10px; }
        .hadith-num { font-size: 12px; font-weight: 800; color: var(--primary); background: var(--input-bg); padding: 4px 8px; border-radius: 6px; }
        
        .arabic { font-family: 'Amiri', serif; font-size: 24px; line-height: 2.2; text-align: right; margin-bottom: 20px; color: var(--text); }
        .translation { font-size: 14px; line-height: 1.6; color: var(--text-muted); text-align: justify; }

        /* Pagination Footer */
        .pagination { position: fixed; bottom: 0; left: 0; right: 0; background: var(--surface); padding: 15px 20px; display: flex; justify-content: space-between; border-top: 1px solid var(--border); box-shadow: 0 -5px 20px rgba(0,0,0,0.05); z-index: 100; padding-bottom: max(15px, env(safe-area-inset-bottom)); }
        
        .loader { text-align: center; padding: 40px; color: var(--text-muted); font-size: 14px; display: none; }
        .error-msg { text-align: center; padding: 20px; color: #ef4444; font-size: 13px; font-weight: 600; display: none; }
    </style>
</head>
<body>

    <div class="header">
        <h1>Kutub Tis'ah</h1>
        <div class="subtitle">9 Imam Besar Hadis</div>
    </div>

    <div class="selector-wrapper">
        <select id="bookSelect" class="book-select" onchange="switchBook(this.value)">
            <option value="bukhari">Sahih Bukhari (7008)</option>
            <option value="muslim">Sahih Muslim (5362)</option>
            <option value="abu-dawud">Sunan Abu Dawud (4590)</option>
            <option value="tirmidzi">Jami' At-Tirmidhi (3891)</option>
            <option value="nasai">Sunan An-Nasa'i (5662)</option>
            <option value="ibnu-majah">Sunan Ibn Majah (4331)</option>
            <option value="ahmad">Musnad Ahmad (26363)</option>
            <option value="malik">Muwatta Malik (1594)</option>
            <option value="darimi">Sunan Ad-Darimi (2949)</option>
        </select>
    </div>

    <div class="controls">
        <input type="number" id="jumpInput" class="search-input" placeholder="No. Hadis (e.g. 1)" inputmode="numeric">
        <button class="action-btn" onclick="jumpToHadith()">GO</button>
    </div>

    <div id="loader" class="loader">Memuatkan Data...</div>
    <div id="error" class="error-msg"></div>
    <div id="content"></div>

    <div class="pagination">
        <button class="action-btn" style="background:var(--input-bg); color:var(--text);" onclick="changePage(-1)" id="prevBtn">Prev</button>
        <span id="pageInfo" style="display:flex; flex-direction:column; justify-content:center; align-items:center; font-size:11px; font-weight:700; color:var(--text-muted);">
            <span id="rangeText">...</span>
        </span>
        <button class="action-btn" onclick="changePage(1)" id="nextBtn">Next</button>
    </div>

<script>
    // --- STATE ---
    const STATE = {
        book: 'bukhari',
        start: 1,
        limit: 20,
        // Max counts for validation (Approximate)
        maxCounts: {
            'bukhari': 7008, 'muslim': 5362, 'abu-dawud': 4590,
            'tirmidzi': 3891, 'nasai': 5662, 'ibnu-majah': 4331,
            'ahmad': 26363, 'malik': 1594, 'darimi': 2949
        }
    };

    // Theme Sync
    try {
        if(window.parent && window.parent.STATE) {
            document.documentElement.setAttribute('data-theme', window.parent.STATE.theme);
        }
    } catch(e) {}

    // Init
    fetchHadith();

    function switchBook(val) {
        STATE.book = val;
        STATE.start = 1;
        fetchHadith();
    }

    function changePage(dir) {
        const nextStart = STATE.start + (dir * STATE.limit);
        if(nextStart < 1) return;
        if(nextStart > STATE.maxCounts[STATE.book]) return;
        STATE.start = nextStart;
        fetchHadith();
        window.scrollTo(0,0);
    }

    function jumpToHadith() {
        const val = parseInt(document.getElementById('jumpInput').value);
        if(val && val > 0 && val <= STATE.maxCounts[STATE.book]) {
            STATE.start = val;
            fetchHadith();
        } else {
            alert(`Sila masukkan nombor antara 1 - ${STATE.maxCounts[STATE.book]}`);
        }
    }

    async function fetchHadith() {
        const list = document.getElementById('content');
        const loader = document.getElementById('loader');
        const err = document.getElementById('error');
        const prevBtn = document.getElementById('prevBtn');
        const rangeText = document.getElementById('rangeText');
        
        // UI Reset
        list.innerHTML = '';
        loader.style.display = 'block';
        err.style.display = 'none';
        prevBtn.disabled = STATE.start <= 1;

        const end = STATE.start + STATE.limit - 1;
        rangeText.textContent = `${STATE.start} - ${end}`;

        // Using Gading API which supports all 9 books
        const url = `https://api.hadith.gading.dev/books/${STATE.book}?range=${STATE.start}-${end}`;

        try {
            const req = await fetch(url);
            const res = await req.json();

            loader.style.display = 'none';

            if(res.code !== 200 && res.code !== 0) { // Code 0 is sometimes returned on success by this API
                 throw new Error("API Response Error");
            }
            
            if(!res.data || !res.data.hadiths || res.data.hadiths.length === 0) {
                 list.innerHTML = `<div style="text-align:center; padding:30px; opacity:0.6;">Tiada data untuk julat ini.</div>`;
                 return;
            }

            res.data.hadiths.forEach(h => {
                const card = document.createElement('div');
                card.className = 'hadith-card';
                // Check if translation exists, fallback if empty
                const translation = h.id || "Terjemahan tidak tersedia.";
                
                card.innerHTML = `
                    <div class="card-header">
                        <span class="hadith-num">#${h.number}</span>
                        <div style="display:flex; gap:10px;">
                            <button onclick="copyHadith('${h.number}', this)" style="background:none; border:none; color:var(--primary); font-size:11px; font-weight:700; cursor:pointer;">COPY</button>
                        </div>
                    </div>
                    <div class="arabic">${h.arab}</div>
                    <div class="translation">${translation}</div>
                `;
                list.appendChild(card);
            });

        } catch (e) {
            console.error(e);
            loader.style.display = 'none';
            err.style.display = 'block';
            err.innerHTML = `Gagal menyambung.<br><small>API mungkin sibuk atau sambungan terputus.</small><br><button onclick="fetchHadith()" class="action-btn" style="margin:10px auto; height:30px; font-size:11px;">Cuba Lagi</button>`;
        }
    }

    function copyHadith(num, btn) {
        const card = btn.closest('.hadith-card');
        const ar = card.querySelector('.arabic').innerText;
        const tr = card.querySelector('.translation').innerText;
        const bookName = document.querySelector(`#bookSelect option[value="${STATE.book}"]`).text;
        
        const txt = `[${bookName} #${num}]\n\n${ar}\n\n${tr}\n\n- WaktuSolat Ultimate`;
        
        navigator.clipboard.writeText(txt).then(() => {
            const original = btn.innerText;
            btn.innerText = "COPIED!";
            setTimeout(() => btn.innerText = original, 2000);
        });
    }
</script>
</body>
</html>
