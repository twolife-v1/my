<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himpunan Doa</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- THEME VARIABLES (MATCHING INDUK.HTML) --- */
        :root[data-theme="light"] { 
            --primary:#A67734; 
            --primary-light:#FDF8F0; 
            --bg:#F8F9FA; 
            --surface:#FFFFFF; 
            --text:#1F2937; 
            --text-muted:#6B7280; 
            --border:#E5E7EB; 
            --glass: rgba(255, 255, 255, 0.85);
        }
        :root[data-theme="dark"] { 
            --primary:#D4AF37; 
            --primary-light:#2A2012; 
            --bg:#121212; 
            --surface:#1E1E1E; 
            --text:#F3F4F6; 
            --text-muted:#9CA3AF; 
            --border:#374151; 
            --glass: rgba(30, 30, 30, 0.85);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            /* Padding for bottom safety if needed */
            padding-bottom: 40px; 
        }

        /* --- STICKY GLASS HEADER --- */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            padding: 15px 20px 10px 20px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .header-title h1 {
            margin: 0;
            font-size: 20px;
            font-weight: 800;
            color: var(--primary);
        }

        .header-title p {
            margin: 2px 0 0;
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* --- SEARCH INPUT --- */
        .search-container { position: relative; margin-bottom: 5px; }
        
        .search-input {
            width: 100%;
            padding: 12px 12px 12px 40px;
            border-radius: 14px;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            outline: none;
            transition: all 0.2s;
        }
        
        .search-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
        }

        /* --- CATEGORIES --- */
        .category-scroll {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 10px 0;
            scrollbar-width: none;
        }
        .category-scroll::-webkit-scrollbar { display: none; }

        .cat-pill {
            white-space: nowrap;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: var(--surface);
            color: var(--text-muted);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .cat-pill.active {
            background: var(--primary);
            color: #fff; /* Always white for contrast on active */
            border-color: var(--primary);
        }

        /* --- CARDS --- */
        .content-area { padding: 10px 20px; max-width: 800px; margin: 0 auto; }

        .doa-card {
            background: var(--surface);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 10px rgba(0,0,0,0.02);
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .doa-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        
        .doa-badge {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 800;
            color: var(--primary);
            background: var(--primary-light);
            padding: 4px 8px;
            border-radius: 6px;
            margin-bottom: 6px;
            display: inline-block;
        }

        .doa-title { font-size: 16px; font-weight: 700; color: var(--text); margin: 0; }

        .doa-actions { display: flex; gap: 8px; }

        .action-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            width: 32px; height: 32px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn:hover { background: var(--bg); color: var(--primary); }
        .action-btn.active-fav { color: #EF4444; fill: #EF4444; }
        .action-btn.active-audio { color: var(--primary); background: var(--primary-light); }
        
        /* Icons */
        .icon { width: 18px; height: 18px; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; fill: none; stroke: currentColor; }

        /* Arabic */
        .doa-arabic {
            font-family: 'Amiri', serif;
            font-size: 26px;
            text-align: right;
            line-height: 2.2;
            color: var(--text);
            margin: 10px 0 20px 0;
        }

        .doa-translation {
            background: var(--bg);
            padding: 15px;
            border-radius: 14px;
            border: 1px solid var(--border);
        }
        
        .doa-rumi {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
            font-style: italic;
        }
        
        .doa-mean {
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-muted);
        }

        /* Toast */
        #toast {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px);
            background: #1F2937; color: #fff; padding: 12px 24px; border-radius: 50px;
            font-size: 12px; font-weight: 600; opacity: 0; transition: all 0.3s; z-index: 100;
        }
        #toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

        .empty-state { text-align: center; padding: 40px 20px; color: var(--text-muted); font-size: 14px; }
    </style>
</head>
<body>

    <header class="app-header">
        <div class="header-top">
            <div class="header-title">
                <h1 id="lbl-title">Himpunan Doa</h1>
                <p id="lbl-subtitle">Panduan Harian Mukmin</p>
            </div>
            <div style="font-size:10px; font-weight:800; color:var(--text-muted); border:1px solid var(--border); padding:4px 8px; border-radius:8px;" id="lang-badge">MS</div>
        </div>

        <div class="search-container">
            <svg class="search-icon icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            <input type="text" id="searchInput" class="search-input" placeholder="Cari doa..." onkeyup="handleSearch()">
        </div>

        <div class="category-scroll" id="categoryWrapper"></div>
    </header>

    <div class="content-area" id="doaContainer"></div>
    <div id="toast">Disalin</div>

    <script>
        // --- TRANSLATION MAPS ---
        const UI_TEXT = {
            ms: { title: "Himpunan Doa", subtitle: "Panduan Harian Mukmin", search: "Cari doa...", copied: "Teks disalin", fav_add: "Ditambah ke kegemaran", fav_rem: "Dibuang dari kegemaran", empty: "Tiada doa dijumpai." },
            en: { title: "Daily Duas", subtitle: "Believer's Daily Guide", search: "Search duas...", copied: "Text copied", fav_add: "Added to favorites", fav_rem: "Removed from favorites", empty: "No duas found." }
        };

        const CATEGORIES = {
            "Semua": { en: "All" },
            "Kegemaran": { en: "Saved" },
            "Harian": { en: "Daily" },
            "Diri": { en: "Self" },
            "Makan": { en: "Food" },
            "Ibadah": { en: "Worship" },
            "Keluarga": { en: "Family" },
            "Ilmu": { en: "Knowledge" },
            "Rezeki": { en: "Provision" },
            "Emosi": { en: "Emotion" },
            "Perjalanan": { en: "Travel" },
            "Kesihatan": { en: "Health" },
            "Alam": { en: "Nature" },
            "Majlis": { en: "Gathering" },
            "Sosial": { en: "Social" }
        };

        // --- DUAL LANGUAGE DATA (Sampled for brevity, full structure applied) ---
        const doaData = [
            // HARIAN
            { id: 1, cat: "Harian", title_ms: "Bangun Tidur", title_en: "Waking Up", arab: "الْحَمْدُ لِلَّهِ الَّذِي أَحْيَانَا بَعْدَ مَا أَمَاتَنَا وَإِلَيْهِ النُّشُورُ", rumi: "Alhamdullillahillazi ahyana ba'da ma amatana wa ilaihin nusyur", mean_ms: "Segala puji bagi Allah yang menghidupkan kami selepas mematikan kami dan kepada-Nya kami akan kembali.", mean_en: "All praise is for Allah who gave us life after having taken it from us and unto Him is the resurrection." },
            { id: 2, cat: "Harian", title_ms: "Sebelum Tidur", title_en: "Before Sleeping", arab: "بِسْمِكَ اللّهُمَّ أَحْيَا وَبِسْمِكَ أَمُوتُ", rumi: "Bismika Allahumma ahya wa bismika amut", mean_ms: "Dengan nama-Mu Ya Allah aku hidup dan dengan nama-Mu aku mati.", mean_en: "In Your name O Allah, I live and I die." },
            { id: 3, cat: "Harian", title_ms: "Zikir Pagi Hari", title_en: "Morning Zikr", arab: "اللَّهُمَّ بِكَ أَصْبَحْنَا وَبِكَ أَمْسَيْنَا...", rumi: "Allahumma bika asbahna wa bika amsaina...", mean_ms: "Ya Allah, dengan-Mu kami berpagi-pagi...", mean_en: "O Allah, by You we enter the morning and by You we enter the evening..." },
            { id: 5, cat: "Harian", title_ms: "Masuk Rumah", title_en: "Entering Home", arab: "بِسْمِ اللَّهِ وَلَجْنَا، وَبِسْمِ اللَّهِ خَرَجْنَا...", rumi: "Bismillahi walajna...", mean_ms: "Dengan nama Allah kami masuk...", mean_en: "In the name of Allah we enter, and in the name of Allah we leave..." },
            { id: 6, cat: "Harian", title_ms: "Keluar Rumah", title_en: "Leaving Home", arab: "بِسْمِ اللَّهِ تَوَكَّلْتُ عَلَى اللَّهِ...", rumi: "Bismillahi tawakkaltu 'alallah...", mean_ms: "Dengan nama Allah, aku bertawakkal...", mean_en: "In the name of Allah, I place my trust in Allah..." },
            
            // MAKAN
            { id: 13, cat: "Makan", title_ms: "Sebelum Makan", title_en: "Before Eating", arab: "اللَّهُمَّ بَارِكْ لَنَا فِيمَا رَزَقْتَنَا...", rumi: "Allahumma barik lana...", mean_ms: "Ya Allah, berkatilah rezeki...", mean_en: "O Allah, bless us in what You have provided us..." },
            { id: 14, cat: "Makan", title_ms: "Selepas Makan", title_en: "After Eating", arab: "الْحَمْدُ لِلَّهِ الَّذِي أَطْعَمَنَا...", rumi: "Alhamdulillahillazi at'amana...", mean_ms: "Segala puji bagi Allah yang telah memberi makan...", mean_en: "Praise be to Allah Who has fed us and given us drink..." },

            // DIRI
            { id: 8, cat: "Diri", title_ms: "Masuk Tandas", title_en: "Entering Toilet", arab: "اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْخُبُثِ وَالْخَبَائِثِ", rumi: "Allahumma inni a'uzubika...", mean_ms: "Ya Allah, aku berlindung dengan-Mu...", mean_en: "O Allah, I seek protection in You from the male and female unclean spirits." },
            { id: 10, cat: "Diri", title_ms: "Melihat Cermin", title_en: "Looking in Mirror", arab: "اللَّهُمَّ كَمَا حَسَّنْتَ خَلْقِي فَحَسِّنْ خُلُقِي", rumi: "Allahumma kama hassanta khalqi...", mean_ms: "Ya Allah, sebagaimana Engkau perelokkan rupaku...", mean_en: "O Allah, just as You have made my external features beautiful, make my character beautiful as well." },

            // IBADAH
            { id: 18, cat: "Ibadah", title_ms: "Masuk Masjid", title_en: "Entering Mosque", arab: "اللَّهُمَّ افْتَحْ لِي أَبْوَابَ رَحْمَتِكَ", rumi: "Allahummaftah li abwaba rahmatik", mean_ms: "Ya Allah, bukakanlah untukku pintu rahmat-Mu.", mean_en: "O Allah, open for me the doors of Your mercy." },
            { id: 20, cat: "Ibadah", title_ms: "Sayyidul Istighfar", title_en: "Master of Istighfar", arab: "اللَّهُمَّ أَنْتَ رَبِّي لَا إِلَهَ إِلَّا أَنْتَ...", rumi: "Allahumma anta rabbi...", mean_ms: "Ya Allah, Engkaulah Tuhanku...", mean_en: "O Allah, You are my Lord, there is no deity except You..." },
            
            // KELUARGA
            { id: 21, cat: "Keluarga", title_ms: "Untuk Ibu Bapa", title_en: "For Parents", arab: "رَبِّ اغْفِرْ لِي وَلِوَالِدَيَّ...", rumi: "Rabbighfir li wa liwalidayya...", mean_ms: "Wahai Tuhanku, ampunilah dosaku...", mean_en: "My Lord, forgive me and my parents and have mercy on them..." },
            { id: 22, cat: "Keluarga", title_ms: "Kebahagiaan Keluarga", title_en: "Family Happiness", arab: "رَبَّنَا هَبْ لَنَا مِنْ أَزْوَاجِنَا...", rumi: "Rabbana hablana min azwajina...", mean_ms: "Wahai Tuhan kami, kurniakanlah...", mean_en: "Our Lord, grant us from among our wives and offspring comfort to our eyes..." },

            // REZEKI
            { id: 25, cat: "Rezeki", title_ms: "Memohon Rezeki", title_en: "Seeking Provision", arab: "اللَّهُمَّ اكْفِنِي بِحَلَالِكَ...", rumi: "Allahummak fini bihalalika...", mean_ms: "Ya Allah, cukupkanlah aku dengan rezeki-Mu...", mean_en: "O Allah, suffice me with Your lawful against Your prohibited..." },
            { id: 27, cat: "Rezeki", title_ms: "Dunia Akhirat", title_en: "Goodness in Both Worlds", arab: "رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً...", rumi: "Rabbana atina fiddunya...", mean_ms: "Wahai Tuhan kami, berilah kami kebaikan...", mean_en: "Our Lord, give us in this world [that which is] good and in the Hereafter [that which is] good..." },

            // EMOSI
            { id: 28, cat: "Emosi", title_ms: "Ketika Marah", title_en: "When Angry", arab: "أَعُوذُ بِاللَّهِ مِنَ الشَّيْطَانِ الرَّجِيمِ", rumi: "A'uzubillahi minasy-syaitanir-rajim", mean_ms: "Aku berlindung kepada Allah...", mean_en: "I seek refuge in Allah from the accursed Satan." },
            { id: 30, cat: "Emosi", title_ms: "Nabi Yunus (Kesulitan)", title_en: "Prophet Yunus (Distress)", arab: "لَا إِلَهَ إِلَّا أَنْتَ سُبْحَانَكَ...", rumi: "La ilaha illa anta subhanaka...", mean_ms: "Tiada Tuhan melainkan Engkau...", mean_en: "There is no deity except You; exalted are You. Indeed, I have been of the wrongdoers." },

            // PERJALANAN
            { id: 32, cat: "Perjalanan", title_ms: "Naik Kenderaan", title_en: "Boarding Vehicle", arab: "سُبْحَانَ الَّذِي سَخَّرَ لَنَا هَذَا...", rumi: "Subhanallazi sakh-khara lana...", mean_ms: "Maha Suci Tuhan yang memudahkan...", mean_en: "Glory to Him who has subjected this to us..." },
            
            // KESIHATAN
            { id: 34, cat: "Kesihatan", title_ms: "Ketika Sakit", title_en: "When Sick", arab: "اللَّهُمَّ رَبَّ النَّاسِ أَذْهِبِ الْبَأْسَ...", rumi: "Allahumma rabban-nas...", mean_ms: "Ya Allah, Tuhan manusia...", mean_en: "O Allah, Lord of mankind, remove the severity and cure..." }
        ];

        // --- GLOBAL STATE ---
        let currentLang = localStorage.getItem('wsl_lang') || 'ms';
        let currentTheme = localStorage.getItem('wsl_theme') || 'light';
        let currentCategory = 'Semua';
        let searchQuery = '';
        let favorites = JSON.parse(localStorage.getItem('mukminDoaFavs')) || [];
        let synth = window.speechSynthesis;

        // ICONS
        const ICONS = {
            vol: '<svg class="icon" viewBox="0 0 24 24"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>',
            heart: '<svg class="icon" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>',
            share: '<svg class="icon" viewBox="0 0 24 24"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>'
        };

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            applyTheme();
            updateLanguage();
            renderCategories();
            renderDoas();
            
            // Listen for theme changes from other tabs/iframe context if possible
            window.addEventListener('storage', (e) => {
                if(e.key === 'wsl_theme') { currentTheme = e.newValue; applyTheme(); }
                if(e.key === 'wsl_lang') { currentLang = e.newValue; updateLanguage(); renderCategories(); renderDoas(); }
            });
        });

        function applyTheme() {
            document.documentElement.setAttribute('data-theme', currentTheme);
        }

        function updateLanguage() {
            const t = UI_TEXT[currentLang];
            document.getElementById('lbl-title').textContent = t.title;
            document.getElementById('lbl-subtitle').textContent = t.subtitle;
            document.getElementById('searchInput').placeholder = t.search;
            document.getElementById('lang-badge').textContent = currentLang.toUpperCase();
        }

        function getCatName(cat) {
            if (currentLang === 'ms') return cat;
            return CATEGORIES[cat] ? CATEGORIES[cat].en : cat;
        }

        function renderCategories() {
            // Unique categories from data
            const uniqueCats = [...new Set(doaData.map(item => item.cat))];
            const allCats = ['Semua', 'Kegemaran', ...uniqueCats];
            
            const wrapper = document.getElementById('categoryWrapper');
            wrapper.innerHTML = allCats.map(cat => `
                <div class="cat-pill ${currentCategory === cat ? 'active' : ''}" 
                     onclick="setCategory('${cat}')">
                     ${getCatName(cat)}
                </div>
            `).join('');
        }

        function setCategory(cat) {
            currentCategory = cat;
            document.getElementById('searchInput').value = '';
            searchQuery = '';
            renderCategories(); // Update active state
            renderDoas();
        }

        function handleSearch() {
            searchQuery = document.getElementById('searchInput').value.toLowerCase();
            renderDoas();
        }

        function toggleFavorite(id) {
            if (favorites.includes(id)) {
                favorites = favorites.filter(favId => favId !== id);
                showToast(UI_TEXT[currentLang].fav_rem);
            } else {
                favorites.push(id);
                showToast(UI_TEXT[currentLang].fav_add);
            }
            localStorage.setItem('mukminDoaFavs', JSON.stringify(favorites));
            renderDoas();
        }

        function renderDoas() {
            const container = document.getElementById('doaContainer');
            
            let filtered = doaData.filter(item => {
                // Get correct language strings
                const title = currentLang === 'ms' ? item.title_ms : (item.title_en || item.title_ms);
                const mean = currentLang === 'ms' ? item.mean_ms : (item.mean_en || item.mean_ms);
                
                // Search logic (checks both languages regardless of setting for better UX)
                const matchesSearch = 
                    title.toLowerCase().includes(searchQuery) || 
                    mean.toLowerCase().includes(searchQuery) || 
                    item.rumi.toLowerCase().includes(searchQuery) ||
                    (item.title_en && item.title_en.toLowerCase().includes(searchQuery)); // Always search English title too

                if (currentCategory === 'Semua') return matchesSearch;
                if (currentCategory === 'Kegemaran') return favorites.includes(item.id) && matchesSearch;
                return item.cat === currentCategory && matchesSearch;
            });

            if (filtered.length === 0) {
                container.innerHTML = `<div class="empty-state">${UI_TEXT[currentLang].empty}</div>`;
                return;
            }

            container.innerHTML = filtered.map(item => {
                const isFav = favorites.includes(item.id);
                const heartStyle = isFav ? 'fill: #EF4444; stroke: #EF4444;' : '';
                
                // Dynamic Text based on Lang
                const displayTitle = currentLang === 'ms' ? item.title_ms : (item.title_en || item.title_ms);
                const displayMean = currentLang === 'ms' ? item.mean_ms : (item.mean_en || item.mean_ms);
                const catLabel = getCatName(item.cat);

                return `
                <div class="doa-card">
                    <div class="doa-top">
                        <div>
                            <span class="doa-badge">${catLabel}</span>
                            <h3 class="doa-title">${displayTitle}</h3>
                        </div>
                        <div class="doa-actions">
                            <button class="action-btn" onclick="playAudio('${item.arab}', this)">${ICONS.vol}</button>
                            <button class="action-btn ${isFav ? 'active-fav' : ''}" onclick="toggleFavorite(${item.id})">
                                <svg class="icon" style="${heartStyle}" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                            </button>
                            <button class="action-btn" onclick="shareDoa(${item.id})">${ICONS.share}</button>
                        </div>
                    </div>
                    <div class="doa-arabic" dir="rtl" lang="ar">${item.arab}</div>
                    <div class="doa-translation">
                        <div class="doa-rumi">${item.rumi}</div>
                        <div class="doa-mean">"${displayMean}"</div>
                    </div>
                </div>
            `}).join('');
        }

        // --- AUDIO (MALE / OFFLINE PRIORITY) ---
        function playAudio(text, btnElement) {
            if (synth.speaking) { 
                synth.cancel(); 
                if(btnElement.classList.contains('active-audio')) { 
                    btnElement.classList.remove('active-audio'); return; 
                } 
            }
            
            document.querySelectorAll('.action-btn').forEach(b => b.classList.remove('active-audio'));
            btnElement.classList.add('active-audio');

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.8; 

            // Voice selection logic
            const availableVoices = synth.getVoices();
            const maleKeywords = ['maged', 'tarik', 'hamel', 'male'];
            let selectedVoice = availableVoices.find(v => v.lang.includes('ar') && maleKeywords.some(k => v.name.toLowerCase().includes(k)));
            if (!selectedVoice) selectedVoice = availableVoices.find(v => v.lang.includes('ar') && v.localService === true);
            if (!selectedVoice) selectedVoice = availableVoices.find(v => v.lang.includes('ar'));

            if (selectedVoice) { utterance.voice = selectedVoice; utterance.lang = selectedVoice.lang; } 
            else { utterance.lang = 'ar-SA'; }

            utterance.onend = () => { btnElement.classList.remove('active-audio'); };
            utterance.onerror = () => { btnElement.classList.remove('active-audio'); };
            synth.speak(utterance);
        }

        function shareDoa(id) {
            const item = doaData.find(d => d.id === id);
            const title = currentLang === 'ms' ? item.title_ms : (item.title_en || item.title_ms);
            const mean = currentLang === 'ms' ? item.mean_ms : (item.mean_en || item.mean_ms);
            
            const shareData = { title: `Doa ${title}`, text: `${title}\n\n${item.arab}\n\n${item.rumi}\n\n"${mean}"\n\n- Mukmin App` };
            
            if (navigator.share) { navigator.share(shareData).catch(console.error); }
            else { 
                navigator.clipboard.writeText(`${shareData.title}\n${shareData.text}`).then(() => showToast(UI_TEXT[currentLang].copied)); 
            }
        }

        function showToast(msg) {
            const t = document.getElementById('toast'); 
            t.innerText = msg; 
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
